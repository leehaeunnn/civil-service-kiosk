<!DOCTYPE html>
<!-- VERSION 3.0 - ìŒì„± ê¸°ëŠ¥ ì¶”ê°€ ì™„ë£Œ -->
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ì™„ë²½í•œ ë¯¼ì›ì²˜ë¦¬ AI í‚¤ì˜¤ìŠ¤í¬ v2.0</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 0;
        }
        
        .main-container {
            width: 100%;
            height: 100vh;
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* í‚¤ì˜¤ìŠ¤í¬ ì‚¬ì´ë“œë°” */
        .kiosk-sidebar {
            width: 400px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .kiosk-step {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .kiosk-step.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            padding: 10px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dee2e6;
            margin: 0 5px;
            transition: all 0.3s ease;
        }
        
        .step-dot.active {
            background: #667eea;
            transform: scale(1.3);
        }
        
        .step-dot.completed {
            background: #4caf50;
        }
        
        .detail-options {
            padding: 10px;
            background: #f0f4f8;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .detail-option {
            display: flex;
            align-items: center;
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .detail-option:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }
        
        .detail-option input[type="checkbox"],
        .detail-option input[type="radio"] {
            margin-right: 10px;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: white;
            border-top: 1px solid #dee2e6;
            position: sticky;
            bottom: 0;
        }
        
        .nav-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nav-btn.back {
            background: #f0f0f0;
            color: #666;
        }
        
        .nav-btn.next {
            background: #667eea;
            color: white;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .kiosk-header {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .kiosk-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .kiosk-subtitle {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .kiosk-section {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .kiosk-section-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .situation-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .situation-btn {
            padding: 12px 8px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.85em;
        }
        
        .situation-btn:hover {
            background: #e3f2fd;
            border-color: #2196f3;
            transform: translateY(-2px);
        }
        
        .situation-btn.selected {
            background: #e3f2fd;
            border-color: #2196f3;
            font-weight: bold;
        }
        
        .kiosk-result {
            padding: 15px;
            background: #e8f5e9;
            margin: 10px;
            border-radius: 10px;
            display: none;
        }
        
        .kiosk-result.active {
            display: block;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .toggle-sidebar {
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
            width: 30px;
            height: 60px;
            background: #667eea;
            border-radius: 0 10px 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 18px;
            z-index: 100;
        }
        
        .kiosk-sidebar.collapsed {
            width: 0;
            overflow: hidden;
        }
        
        .kiosk-sidebar.collapsed .toggle-sidebar {
            right: 0;
            border-radius: 10px 0 0 10px;
        }

        .chat-container {
            flex: 1;
            height: 100vh;
            background: #fff;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        @media (max-width: 480px) {
            .api-settings-btn {
                padding: 8px 12px;
                font-size: 0.9em;
                right: 10px;
            }
            
            .bot-name {
                font-size: 1em;
            }
            
            .bot-status {
                font-size: 0.8em;
            }
            
            .quick-menu {
                padding: 10px;
            }
            
            .quick-btn {
                font-size: 0.8em;
                padding: 8px 12px;
            }
            
            .quick-btn.category {
                min-width: 80px;
            }
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 10;
        }

        .bot-avatar {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .bot-info {
            flex: 1;
        }

        .bot-name {
            font-size: 1.2em;
            font-weight: 500;
        }

        .bot-status {
            font-size: 0.9em;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #4caf50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* API ì„¤ì • ë²„íŠ¼ */
        .api-settings-btn {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.3);
            border: 2px solid white;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .api-settings-btn:hover {
            background: rgba(255,255,255,0.5);
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
        }

        /* API ì„¤ì • ëª¨ë‹¬ */
        .api-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .api-modal.active {
            display: flex;
        }

        .api-modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
        }

        .api-modal h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .api-input-group {
            margin-bottom: 15px;
        }

        .api-input-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 0.9em;
        }

        .api-input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .api-input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .api-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .api-buttons button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .api-save {
            background: #667eea;
            color: white;
        }

        .api-save:hover {
            background: #5a6fd8;
        }

        .api-cancel {
            background: #f0f0f0;
            color: #666;
        }

        .api-cancel:hover {
            background: #e0e0e0;
        }

        .api-status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 8px;
            font-size: 0.9em;
            text-align: center;
        }

        .api-status.active {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .api-status.inactive {
            background: #fef5e7;
            color: #f57c00;
        }

        /* ë¹ ë¥¸ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
        .quick-menu {
            padding: 15px;
            background: white;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .quick-menu-title {
            width: 100%;
            text-align: center;
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .quick-btn {
            padding: 10px 15px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            font-weight: 500;
            color: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .quick-btn.category {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            min-width: 100px;
        }
        
        .quick-btn.category:hover {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f5f7fb;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #bbb;
            border-radius: 4px;
        }

        .message {
            display: flex;
            gap: 10px;
            animation: messageSlide 0.3s ease;
            max-width: 85%;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message.bot {
            align-self: flex-start;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: #667eea;
            color: white;
        }

        .message.bot .message-avatar {
            background: #f0f0f0;
        }

        .message-content {
            background: white;
            padding: 12px 16px;
            border-radius: 18px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .message.user .message-content {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.bot .message-content {
            background: white;
            border-bottom-left-radius: 4px;
        }

        .message-text {
            line-height: 1.6;
            word-break: keep-all;
        }
        
        .message-text strong {
            display: inline-block;
            margin-top: 8px;
            margin-bottom: 4px;
            color: #333;
            font-size: 1.05em;
            font-weight: 600;
        }
        
        .message-text br + br {
            display: none;
        }
        
        .message.bot .message-text ul {
            margin: 8px 0;
            padding-left: 20px;
        }
        
        .message.bot .message-text li {
            margin: 4px 0;
        }

        .message-time {
            font-size: 0.75em;
            color: #999;
            margin-top: 5px;
        }

        .message.user .message-time {
            color: rgba(255, 255, 255, 0.8);
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 10px;
        }

        .typing-indicator.active {
            display: flex;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: white;
            border-radius: 18px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typingDot 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingDot {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .chat-input-container {
            padding: 15px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            background: #f5f7fb;
            border-radius: 25px;
            padding: 5px 15px;
            transition: all 0.3s ease;
        }

        .input-wrapper:focus-within {
            background: #e8ecf4;
            box-shadow: 0 0 0 2px #667eea;
        }

        .chat-input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 10px 0;
            font-size: 1em;
            outline: none;
        }

        .input-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: #667eea;
        }

        .input-btn:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.1);
        }

        .send-btn {
            background: #667eea;
            color: white;
        }

        .send-btn:hover {
            background: #5a6fd8;
        }

        .mic-btn.listening {
            background: #f44336;
            color: white;
            animation: pulse-mic 1.5s infinite;
        }

        @keyframes pulse-mic {
            0% {
                box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(244, 67, 54, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(244, 67, 54, 0);
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- í‚¤ì˜¤ìŠ¤í¬ ì‚¬ì´ë“œë°” -->
        <div class="kiosk-sidebar" id="kioskSidebar">
            <div class="toggle-sidebar" onclick="toggleSidebar()">
                <span id="toggleIcon">â—€</span>
            </div>
            
            <div class="kiosk-header">
                <div class="kiosk-title">ğŸ¢ ìŠ¤ë§ˆíŠ¸ ë¯¼ì›ì²˜ë¦¬ ë„ìš°ë¯¸</div>
                <div class="kiosk-subtitle">ë‹¨ê³„ë³„ë¡œ ì•ˆë‚´í•´ë“œë¦´ê²Œìš”</div>
            </div>
            
            <!-- ë‹¨ê³„ í‘œì‹œê¸° -->
            <div class="step-indicator">
                <div class="step-dot active" id="step1Dot"></div>
                <div class="step-dot" id="step2Dot"></div>
                <div class="step-dot" id="step3Dot"></div>
                <div class="step-dot" id="step4Dot"></div>
            </div>
            
            <!-- STEP 1: ë‚˜ì´ ì„ íƒ -->
            <div class="kiosk-step active" id="step1">
                <div class="kiosk-section">
                    <div class="kiosk-section-title">
                        <span>ğŸ‘¤</span> STEP 1: ì—°ë ¹ëŒ€ë¥¼ ì„ íƒí•˜ì„¸ìš”
                    </div>
                    <div class="situation-grid">
                        <button class="situation-btn" onclick="selectAgeStep('youth')" data-age="youth">
                            ğŸ‘¶ ë¯¸ì„±ë…„ì<br>(19ì„¸ ë¯¸ë§Œ)
                        </button>
                        <button class="situation-btn" onclick="selectAgeStep('young')" data-age="young">
                            ğŸ§‘ ì²­ë…„<br>(19-34ì„¸)
                        </button>
                        <button class="situation-btn" onclick="selectAgeStep('middle')" data-age="middle">
                            ğŸ‘¨ ì¤‘ì¥ë…„<br>(35-64ì„¸)
                        </button>
                        <button class="situation-btn" onclick="selectAgeStep('early-senior')" data-age="early-senior">
                            ğŸ‘´ ì˜ˆë¹„ë…¸ì¸<br>(60-64ì„¸)
                        </button>
                        <button class="situation-btn" onclick="selectAgeStep('senior')" data-age="senior">
                            ğŸ‘µ ë…¸ì¸<br>(65ì„¸ ì´ìƒ)
                        </button>
                        <button class="situation-btn" onclick="selectAgeStep('senior-plus')" data-age="senior-plus">
                            ğŸ§“ ê³ ë ¹ë…¸ì¸<br>(75ì„¸ ì´ìƒ)
                        </button>
                        <button class="situation-btn" onclick="showCustomAgeInput()" data-age="other">
                            âœï¸ ê¸°íƒ€<br>(ì§ì ‘ ì…ë ¥)
                        </button>
                    </div>
                    <div id="customAgeInput" style="display: none; margin-top: 15px;">
                        <input type="text" id="customAge" placeholder="ë‚˜ì´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 45ì„¸)" 
                               style="padding: 10px; width: 200px; border: 1px solid #ddd; border-radius: 5px;">
                        <button onclick="submitCustomAge()" 
                                style="padding: 10px 20px; margin-left: 10px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            í™•ì¸
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- STEP 2: ìƒí™© ì„ íƒ -->
            <div class="kiosk-step" id="step2">
                <div class="kiosk-section">
                    <div class="kiosk-section-title">
                        <span>ğŸ’­</span> STEP 2: í˜„ì¬ ìƒí™©ì„ ì„ íƒí•˜ì„¸ìš”
                    </div>
                    <div id="situationOptions"></div>
                </div>
            </div>
            
            <!-- STEP 3: ì„¸ë¶€ ì¡°ê±´ -->
            <div class="kiosk-step" id="step3">
                <div class="kiosk-section">
                    <div class="kiosk-section-title">
                        <span>ğŸ“‹</span> STEP 3: ì„¸ë¶€ ì¡°ê±´ì„ í™•ì¸í•˜ì„¸ìš”
                    </div>
                    <div id="detailConditions"></div>
                </div>
            </div>
            
            <!-- STEP 4: ë§ì¶¤ ì„œë¹„ìŠ¤ ë° ì‹ ì²­ ì•ˆë‚´ -->
            <div class="kiosk-step" id="step4">
                <div class="kiosk-section">
                    <div class="kiosk-section-title">
                        <span>âœ¨</span> STEP 4: ë§ì¶¤ ì„œë¹„ìŠ¤ & ì‹ ì²­ ì•ˆë‚´
                    </div>
                    <div id="finalRecommendations"></div>
                </div>
            </div>
            
            <!-- ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
            <div class="navigation-buttons">
                <button class="nav-btn back" onclick="previousStep()" id="backBtn" disabled>
                    â† ì´ì „ ë‹¨ê³„
                </button>
                <button class="nav-btn next" onclick="nextStep()" id="nextBtn" disabled>
                    ë‹¤ìŒ ë‹¨ê³„ â†’
                </button>
            </div>
        </div>
        
        <!-- ì±„íŒ… ì»¨í…Œì´ë„ˆ -->
        <div class="chat-container">
        <div class="chat-header">
            <div class="bot-avatar">ğŸ¤–</div>
            <div class="bot-info">
                <div class="bot-name">ì™„ë²½í•œ ë¯¼ì› AI</div>
                <div class="bot-status">
                    <span class="status-dot"></span>
                    <span id="statusText">ë¡œì»¬ AI ëª¨ë“œ</span>
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="api-settings-btn" onclick="toggleSpeech()" style="background: white; color: #667eea; font-size: 1em; font-weight: bold; border: none; padding: 10px 15px;" title="ìŒì„± ì¼œê¸°/ë„ê¸°">
                    <span id="speechIcon">ğŸ”Š</span> <span id="speechText">ìŒì„± ON</span>
                </button>
                <button class="api-settings-btn" onclick="testVoice()" style="background: #ffeaa7; color: #d63031; font-size: 1em; font-weight: bold; border: none; padding: 10px 15px;" title="ìŒì„± í…ŒìŠ¤íŠ¸">
                    ğŸ¤ í…ŒìŠ¤íŠ¸
                </button>
                <button class="api-settings-btn" onclick="showAPIModal()" style="background: white; color: #667eea; font-size: 1em; font-weight: bold; border: none;">
                    âš™ï¸ API ì„¤ì •
                </button>
            </div>
        </div>

        <!-- ë¹ ë¥¸ ë©”ë‰´ ë²„íŠ¼ë“¤ -->
        <div class="quick-menu">
            <div class="quick-menu-title">ğŸ’¡ ìì£¼ ì°¾ëŠ” ì„œë¹„ìŠ¤ (í´ë¦­í•˜ì„¸ìš”)</div>
            
            <!-- ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ë“¤ -->
            <button class="quick-btn category" onclick="handleQuickMenu('ë…¸ì¸ë³µì§€')">
                ğŸ‘´ ë…¸ì¸ë³µì§€
            </button>
            <button class="quick-btn category" onclick="handleQuickMenu('ìƒí™œì§€ì›')">
                ğŸ’° ìƒí™œì§€ì›
            </button>
            <button class="quick-btn category" onclick="handleQuickMenu('ì£¼ê±°ë³µì§€')">
                ğŸ  ì£¼ê±°ë³µì§€
            </button>
            <button class="quick-btn category" onclick="handleQuickMenu('ì˜ë£Œì§€ì›')">
                ğŸ¥ ì˜ë£Œì§€ì›
            </button>
            <button class="quick-btn category" onclick="handleQuickMenu('ì¼ìë¦¬')">
                ğŸ’¼ ì¼ìë¦¬
            </button>
            
            <!-- êµ¬ì²´ì  ì„œë¹„ìŠ¤ ë²„íŠ¼ë“¤ -->
            <button class="quick-btn" onclick="handleQuickService('ê¸°ì´ˆì—°ê¸ˆ')">
                ê¸°ì´ˆì—°ê¸ˆ
            </button>
            <button class="quick-btn" onclick="handleQuickService('ê¸°ì´ˆìƒí™œìˆ˜ê¸‰')">
                ê¸°ì´ˆìƒí™œìˆ˜ê¸‰
            </button>
            <button class="quick-btn" onclick="handleQuickService('ê¸´ê¸‰ë³µì§€')">
                ê¸´ê¸‰ë³µì§€
            </button>
            <button class="quick-btn" onclick="handleQuickService('ì „ì…ì‹ ê³ ')">
                ì „ì…ì‹ ê³ 
            </button>
            <button class="quick-btn" onclick="handleQuickService('ì£¼ë¯¼ë“±ë¡ë“±ë³¸')">
                ì£¼ë¯¼ë“±ë¡ë“±ë³¸
            </button>
            <button class="quick-btn" onclick="handleQuickService('ì—¬ê¶Œë°œê¸‰')">
                ì—¬ê¶Œë°œê¸‰
            </button>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                <div class="message-avatar">ğŸ¤–</div>
                <div class="message-content">
                    <div class="message-text">
                        ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”. ğŸ˜Š<br><br>
                        ì˜ˆì‹œ:<br>
                        â€¢ "ìœ¡ì‹­ì´ ë„˜ì—ˆëŠ”ë° ëˆ ë°›ì„ ìˆ˜ ìˆëŠ”ê±° ë­ ì—†ëƒ"<br>
                        â€¢ "ë‚˜ì´ê°€ ì¢€ ìˆëŠ”ë° ìƒí™œì´ í˜ë“¤ì–´"<br>
                        â€¢ "ì´ì‚¬í–ˆëŠ”ë° ë­ í•´ì•¼ë¼"<br><br>
                        ğŸ’¡ ë” ë˜‘ë˜‘í•œ ë‹µë³€ì„ ì›í•˜ì‹œë©´ ìƒë‹¨ì˜ âš™ï¸ API ì„¤ì •ì„ í´ë¦­í•˜ì„¸ìš”!
                    </div>
                    <div class="message-time"></div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="message-avatar">ğŸ¤–</div>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
        </div>

        <div class="chat-input-container">
            <div class="input-wrapper">
                <input 
                    type="text" 
                    class="chat-input" 
                    id="chatInput" 
                    placeholder="ì•„ë¬´ ë§ì´ë‚˜ í¸í•˜ê²Œ í•˜ì„¸ìš”..."
                    onkeypress="handleKeyPress(event)"
                >
                <button class="input-btn mic-btn" id="micBtn" onclick="toggleVoiceInput()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                    </svg>
                </button>
            </div>
            <button class="input-btn send-btn" onclick="sendTextMessage()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- API ì„¤ì • ëª¨ë‹¬ -->
    <div class="api-modal" id="apiModal">
        <div class="api-modal-content">
            <h2>ğŸ”§ í•˜ì´ë¸Œë¦¬ë“œ AI ì„¤ì •</h2>
            
            <div class="api-input-group">
                <label>API ì œê³µì ì„ íƒ</label>
                <select id="apiProvider" onchange="updateAPIStatus()">
                    <option value="">ì‚¬ìš© ì•ˆí•¨ (ë¡œì»¬ AI)</option>
                    <option value="openai">OpenAI (GPT-4) - í´ë¼ìš°ë“œ</option>
                    <option value="google">Google Gemini - í´ë¼ìš°ë“œ</option>
                    <option value="local">ë¡œì»¬ SLM (Gemma/Llama)</option>
                </select>
            </div>
            
            <div class="api-input-group" id="apiKeyGroup">
                <label>API Key</label>
                <input type="password" id="apiKey" placeholder="API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            
            <div class="api-input-group" id="localEndpointGroup" style="display: none;">
                <label>ë¡œì»¬ SLM ì—”ë“œí¬ì¸íŠ¸</label>
                <input type="text" id="localEndpoint" placeholder="http://localhost:8080/v1/chat/completions" 
                       value="http://localhost:8080/v1/chat/completions">
            </div>
            
            <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 8px;">
                <label style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="hybridMode" checked>
                    <span><strong>í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ</strong> - ë¯¼ê°ì •ë³´ ìë™ ë¶„ê¸°</span>
                </label>
                <small style="display: block; margin-top: 5px; color: #666;">
                    âœ… ì¼ë°˜ ì§ˆì˜: í´ë¼ìš°ë“œ LLM ì‚¬ìš©<br>
                    ğŸ”’ ë¯¼ê°ì •ë³´ í¬í•¨: ë¡œì»¬ SLM ì‚¬ìš©
                </small>
            </div>
            
            <div style="margin-top: 10px; padding: 10px; background: #f0f4f8; border-radius: 8px;">
                <label style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="ragEnabled" checked>
                    <span><strong>RAG ì‹œìŠ¤í…œ</strong> - ë²•ë ¹/FAQ ê²€ìƒ‰</span>
                </label>
                <small style="display: block; margin-top: 5px; color: #666;">
                    ğŸ“š 2,000+ ë²•ë ¹, 5,000+ FAQ, 10,000+ ì‚¬ë¡€ ê²€ìƒ‰
                </small>
            </div>
            
            <div class="api-status inactive" id="apiStatus">
                í˜„ì¬ ë¡œì»¬ AI ëª¨ë“œë¡œ ì‘ë™ì¤‘
            </div>
            
            <div class="api-buttons">
                <button class="api-save" onclick="saveAPISettings()">ì €ì¥</button>
                <button class="api-cancel" onclick="closeAPIModal()">ì·¨ì†Œ</button>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; font-size: 0.9em;">
                <strong>ğŸ”’ ë³´ì•ˆ ì•ˆë‚´:</strong><br>
                â€¢ ê°œì¸ì •ë³´ëŠ” ìë™ íƒì§€ë˜ì–´ ë¡œì»¬ì—ì„œ ì²˜ë¦¬<br>
                â€¢ ë¯¼ê°ì •ë³´ ì²˜ë¦¬ ë¡œê·¸ ìë™ ì €ì¥<br>
                â€¢ ê°œì¸ì •ë³´ë³´í˜¸ë²• ì¤€ìˆ˜
            </div>
            
            <div style="margin-top: 10px; padding: 15px; background: #f5f5f5; border-radius: 8px; font-size: 0.9em;">
                <strong>ğŸ’¡ API Key ì–»ëŠ” ë°©ë²•:</strong><br>
                â€¢ OpenAI: <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com</a><br>
                â€¢ Google AI: <a href="https://makersuite.google.com/app/apikey" target="_blank">makersuite.google.com</a>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let recognition = null;
        let isListening = false;
        let isSpeechEnabled = true; // ìŒì„± ì¶œë ¥ í™œì„±í™” ì—¬ë¶€
        let selectedAge = null;
        let selectedSituation = null;
        let conversationContext = {
            history: [],
            lastTopic: null,
            userData: {}
        };

        // API ì„¤ì •
        let apiConfig = {
            provider: localStorage.getItem('apiProvider') || '',
            apiKey: localStorage.getItem('apiKey') || '',
            useAPI: false,
            localSLMEndpoint: localStorage.getItem('localSLMEndpoint') || 'http://localhost:8080/v1/chat/completions',
            useHybrid: localStorage.getItem('useHybrid') !== 'false'  // ê¸°ë³¸ê°’ true
        };

        // RAG ì‹œìŠ¤í…œ ì„¤ì •
        const ragConfig = {
            enabled: localStorage.getItem('ragEnabled') !== 'false',  // ê¸°ë³¸ê°’ true
            vectorDBEndpoint: 'http://localhost:6333',
            collections: {
                laws: 'korean_laws',        // 2,000+ ë²•ë ¹
                faqs: 'civil_service_faqs', // 5,000+ FAQ
                cases: 'past_cases'         // 10,000+ ê³¼ê±° ë¯¼ì›ì‚¬ë¡€
            },
            topK: 5,
            threshold: 0.7
        };

        // ë¯¼ê°ì •ë³´ íƒì§€ ì‹œìŠ¤í…œ
        const sensitiveInfoDetector = {
            patterns: {
                rrn: /\b(?:[0-9]{2}(?:0[1-9]|1[0-2])(?:0[1-9]|[1,2][0-9]|3[0,1]))-?([1-4][0-9]{6})\b/g,
                passport: /\b[A-Z]{1,2}[0-9]{8}\b/g,
                driverLicense: /\b[0-9]{2}-[0-9]{2}-[0-9]{6}-[0-9]{2}\b/g,
                creditCard: /\b(?:[0-9]{4}[-\s]?){3}[0-9]{4}\b/g,
                bankAccount: /\b[0-9]{10,14}\b/g,
                phone: /\b(?:010|011|016|017|018|019)-?[0-9]{3,4}-?[0-9]{4}\b/g,
                email: /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g
            },
            
            nerEntities: ['PERSON', 'LOCATION', 'ORGANIZATION', 'MONEY', 'DATE'],
            
            detect: function(text) {
                const detectedInfo = {
                    hasSensitive: false,
                    types: [],
                    maskedText: text,
                    severity: 'low'
                };
                
                for (const [type, pattern] of Object.entries(this.patterns)) {
                    if (pattern.test(text)) {
                        detectedInfo.hasSensitive = true;
                        detectedInfo.types.push(type);
                        detectedInfo.maskedText = detectedInfo.maskedText.replace(pattern, (match) => {
                            return match.substring(0, 3) + '*'.repeat(match.length - 3);
                        });
                    }
                }
                
                if (detectedInfo.types.includes('rrn') || detectedInfo.types.includes('creditCard')) {
                    detectedInfo.severity = 'high';
                } else if (detectedInfo.types.includes('phone') || detectedInfo.types.includes('bankAccount')) {
                    detectedInfo.severity = 'medium';
                }
                
                return detectedInfo;
            },
            
            logDetection: function(detectedInfo, source) {
                const log = {
                    timestamp: new Date().toISOString(),
                    source: source,
                    types: detectedInfo.types,
                    severity: detectedInfo.severity,
                    action: detectedInfo.hasSensitive ? 'BLOCKED' : 'ALLOWED'
                };
                
                const logs = JSON.parse(localStorage.getItem('sensitiveInfoLogs') || '[]');
                logs.push(log);
                localStorage.setItem('sensitiveInfoLogs', JSON.stringify(logs.slice(-100)));
                
                console.log('[Security Audit]', log);
            }
        };

        // API ëª¨ë‹¬ ê´€ë ¨
        function showAPIModal() {
            document.getElementById('apiModal').classList.add('active');
            document.getElementById('apiProvider').value = apiConfig.provider;
            document.getElementById('apiKey').value = apiConfig.apiKey;
            document.getElementById('localEndpoint').value = apiConfig.localSLMEndpoint;
            document.getElementById('hybridMode').checked = apiConfig.useHybrid;
            document.getElementById('ragEnabled').checked = ragConfig.enabled;
            updateAPIStatus();
        }

        function closeAPIModal() {
            document.getElementById('apiModal').classList.remove('active');
        }

        function saveAPISettings() {
            const provider = document.getElementById('apiProvider').value;
            const apiKey = document.getElementById('apiKey').value;
            const localEndpoint = document.getElementById('localEndpoint').value;
            const hybridMode = document.getElementById('hybridMode').checked;
            const ragEnabled = document.getElementById('ragEnabled').checked;
            
            apiConfig.provider = provider;
            apiConfig.apiKey = apiKey;
            apiConfig.localSLMEndpoint = localEndpoint;
            apiConfig.useHybrid = hybridMode;
            apiConfig.useAPI = (provider && (provider === 'local' || apiKey));
            
            ragConfig.enabled = ragEnabled;
            
            // ì„¤ì • ì €ì¥
            localStorage.setItem('apiProvider', provider);
            localStorage.setItem('apiKey', apiKey);
            localStorage.setItem('localSLMEndpoint', localEndpoint);
            localStorage.setItem('useHybrid', hybridMode);
            localStorage.setItem('ragEnabled', ragEnabled);
            
            updateAPIStatus();
            closeAPIModal();
            
            // í—¤ë” ìƒíƒœ ì—…ë°ì´íŠ¸
            const statusText = document.getElementById('statusText');
            if (apiConfig.useAPI) {
                if (provider === 'local') {
                    statusText.textContent = 'ë¡œì»¬ SLM ëª¨ë“œ';
                } else {
                    statusText.textContent = `${provider === 'openai' ? 'OpenAI' : 'Google Gemini'} ëª¨ë“œ`;
                }
            } else {
                statusText.textContent = 'ë¡œì»¬ AI ëª¨ë“œ';
            }
            
            // ì‹œìŠ¤í…œ ìƒíƒœ ë¡œê·¸
            console.log('ğŸ”„ ì„¤ì • ì—…ë°ì´íŠ¸:');
            console.log('â€¢ í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ:', hybridMode ? 'í™œì„±' : 'ë¹„í™œì„±');
            console.log('â€¢ RAG ì‹œìŠ¤í…œ:', ragEnabled ? 'í™œì„±' : 'ë¹„í™œì„±');
            console.log('â€¢ API ì œê³µì:', provider || 'ì—†ìŒ');
        }

        function updateAPIStatus() {
            const status = document.getElementById('apiStatus');
            const provider = document.getElementById('apiProvider').value;
            const apiKeyGroup = document.getElementById('apiKeyGroup');
            const localEndpointGroup = document.getElementById('localEndpointGroup');
            
            // UI ì—…ë°ì´íŠ¸
            if (provider === 'local') {
                apiKeyGroup.style.display = 'none';
                localEndpointGroup.style.display = 'block';
                status.className = 'api-status active';
                status.textContent = 'ë¡œì»¬ SLM ëª¨ë“œ í™œì„±í™”';
            } else if (provider) {
                apiKeyGroup.style.display = 'block';
                localEndpointGroup.style.display = 'none';
                if (document.getElementById('apiKey').value) {
                    status.className = 'api-status active';
                    status.textContent = `${provider === 'openai' ? 'OpenAI' : 'Google Gemini'} API í™œì„±í™”`;
                } else {
                    status.className = 'api-status inactive';
                    status.textContent = 'API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”';
                }
            } else {
                apiKeyGroup.style.display = 'block';
                localEndpointGroup.style.display = 'none';
                status.className = 'api-status inactive';
                status.textContent = 'ë¡œì»¬ AI ëª¨ë“œë¡œ ì‘ë™ì¤‘';
            }
        }

        // ì™„ë²½í•œ íŒ¨í„´ ë§¤ì¹­ ì‹œìŠ¤í…œ
        const patternMatcher = {
            // ëª¨ë“  ê°€ëŠ¥í•œ í‘œí˜„ ë§¤ì¹­
            match: function(input) {
                const text = input.toLowerCase().replace(/\s+/g, ' ');
                
                // ì§ì ‘ ë§¤ì¹­ íŒ¨í„´ë“¤ - ë”ìš± í¬ê´„ì ìœ¼ë¡œ í™•ì¥
                const patterns = [
                    // ë‚˜ì´ + ëˆ/ì§€ì› - ëª¨ë“  ê°€ëŠ¥í•œ í‘œí˜„
                    { regex: /(ìœ¡ì‹­|ì¹ ì‹­|íŒ”ì‹­|êµ¬ì‹­|ì˜ˆìˆœ|ì¼í”|ì—¬ë“ |ì•„í”|ë‚˜ì´|ë…¸ì¸|ì–´ë¥´ì‹ |ëŠ™ì€|ê³ ë ¹).*(ëˆ|ì§€ì›|í˜œíƒ|ë°›|ë³´ì¡°|ìˆ˜ë‹¹|ì—°ê¸ˆ|ì›”ì„¸|ìƒí™œë¹„)/, response: 'elderly_financial' },
                    { regex: /(ëˆ|ì§€ì›|í˜œíƒ|ìˆ˜ë‹¹|ì—°ê¸ˆ).*(ìœ¡ì‹­|ì¹ ì‹­|íŒ”ì‹­|êµ¬ì‹­|ì˜ˆìˆœ|ì¼í”|ì—¬ë“ |ì•„í”|ë‚˜ì´|ë…¸ì¸|ì–´ë¥´ì‹ )/, response: 'elderly_financial' },
                    { regex: /(\d{2})(ì‚´|ì„¸).*(ëˆ|ì§€ì›|ë°›|í˜œíƒ|ìˆ˜ë‹¹)/, response: 'elderly_financial' },
                    { regex: /(ë‚˜ì´ê°€?.*(ì¢€|ë§|ìˆ|ë“¤).*(ëˆ|ìˆ˜ì…|ë²Œ|ìƒí™œ|ë¨¹ê³ ))/, response: 'elderly_financial' },
                    { regex: /(ëŠ™ì–´|ë‚˜ì´.?ë“¤ì–´).*(ëˆ|ìƒí™œ|ë¨¹ê³ |ì‚´)/, response: 'elderly_financial' },
                    { regex: /(ìœ¡ì‹­ì´.?ë„˜|ì¹ ì‹­.?ë„˜|íŒ”ì‹­.?ë„˜).*(ëˆ|ë°›|ì§€ì›|í˜œíƒ)/, response: 'elderly_financial' },
                    
                    // ìƒí™œ ì–´ë ¤ì›€ - ë‹¤ì–‘í•œ í‘œí˜„
                    { regex: /(ìƒí™œ|ìƒê³„|ë¨¹ê³ |ì‚´ê¸°).*(ì–´ë ¤|í˜ë“¤|ëª»|ë¹ ë“¯|ë¶€ì¡±)/, response: 'financial_difficulty' },
                    { regex: /(ëˆ|ìˆ˜ì…|ë²Œì´|ì†Œë“).*(ì—†|ëª»|ë¶€ì¡±|ë–¨ì–´)/, response: 'financial_difficulty' },
                    { regex: /(ë²Œ.?ìˆ˜.?ìˆëŠ”.*(ìˆ˜ë‹¨|ë°©ë²•|ì¼))/, response: 'financial_difficulty' },
                    { regex: /(ê°€ë‚œ|ë¹ˆê³¤|ì–´ë ¤ìš´|ëª».?ì‚´|í˜ë“ ).*(ìƒí™©|í˜•í¸|ì²˜ì§€)/, response: 'financial_difficulty' },
                    { regex: /(ì›”ì„¸|ì „ì„¸|ì§‘ì„¸|ê³µê³¼ê¸ˆ).*(ëª»|ë°€|í˜ë“¤)/, response: 'financial_difficulty' },
                    
                    // ì¼ìë¦¬/ì·¨ì—…
                    { regex: /(ì¼|ì¼ìë¦¬|ì§ì¥|ì·¨ì—…|ì•Œë°”|ì•„ë¥´ë°”ì´íŠ¸).*(êµ¬í•˜|ì°¾|ì—†|í•„ìš”)/, response: 'job_search' },
                    { regex: /(ëˆ.*(ë²Œ|ë²„ëŠ”|ë²Œì´)).*(ë°©ë²•|ìˆ˜ë‹¨|ì¼)/, response: 'job_search' },
                    { regex: /(ë…¸ì¸|ì–´ë¥´ì‹ |ì‹œë‹ˆì–´).*(ì¼ìë¦¬|ì·¨ì—…|ì¼.?í•˜ê³ )/, response: 'elderly_job' },
                    
                    // ì´ì‚¬/ì „ì…
                    { regex: /(ì´ì‚¬|ì „ì…|ì£¼ì†Œ|ê±°ì£¼ì§€).*(í–ˆ|ì™”|ì˜®|ë³€ê²½|ì‹ ê³ )/, response: 'moving' },
                    { regex: /(ìƒˆì§‘|ìƒˆë¡œìš´ì§‘|ë‹¤ë¥¸ë™ë„¤|ì´ì‚¬.?ê°€|ì´ì‚¬.?ì™€)/, response: 'moving' },
                    
                    // ì¶œì‚°/ìœ¡ì•„
                    { regex: /(ì•„ê¸°|ì• ê¸°|ì•„ì´|ì¶œì‚°|ì„ì‹ ).*(ë‚³|íƒœì–´|ì¶œì‚°|ì˜ˆì •|ì§€ì›)/, response: 'birth' },
                    { regex: /(ì¶œì‚°|ì¶œìƒ).*(ì‹ ê³ |ë“±ë¡|ìˆ˜ë‹¹|ì§€ì›ê¸ˆ)/, response: 'birth' },
                    { regex: /(ì–‘ìœ¡|ìœ¡ì•„|ë³´ìœ¡).*(ì§€ì›|ìˆ˜ë‹¹|ë„ì›€)/, response: 'childcare' },
                    
                    // ì˜ë£Œ/ê±´ê°•
                    { regex: /(ë³‘ì›|ì˜ë£Œ|ê±´ê°•|ì•„í”„|ì•„í”ˆ|ì¹˜ë£Œ).*(ë¹„|ì§€ì›|ë³´í—˜|ë„ì›€)/, response: 'medical' },
                    { regex: /(ì˜ë£Œê¸‰ì—¬|ê±´ê°•ë³´í—˜|ì‹¤ì†|ë³´í—˜ë£Œ).*(ì‹ ì²­|ì§€ì›|ê°ë©´)/, response: 'medical' },
                    
                    // ì„œë¥˜
                    { regex: /(ë“±ë³¸|ì´ˆë³¸|ì„œë¥˜|ì¦ëª…ì„œ|ì¸ê°).*(í•„ìš”|ë°œê¸‰|ë–¼|ë½‘|ì–´ë””)/, response: 'document' },
                    
                    // ì£¼ê±°
                    { regex: /(ì§‘|ì£¼íƒ|ì•„íŒŒíŠ¸|ì„ëŒ€|ì „ì„¸|ì›”ì„¸).*(ì§€ì›|ì‹ ì²­|êµ¬í•˜|ì—†)/, response: 'housing' },
                    { regex: /(lh|sh|ì£¼ê±°|ì£¼íƒ).*(ì‹ ì²­|ìê²©|ì¡°ê±´)/, response: 'housing' },
                    
                    // ì—¬ê¶Œ
                    { regex: /(ì—¬ê¶Œ|íŒ¨ìŠ¤í¬íŠ¸|í•´ì™¸|ì™¸êµ­).*(í•„ìš”|ë§Œë“¤|ë°œê¸‰|ì‹ ì²­)/, response: 'passport' }
                ];
                
                for (const pattern of patterns) {
                    if (pattern.regex.test(text)) {
                        return pattern.response;
                    }
                }
                
                // ë‚˜ì´ ì¶”ì¶œ ë° ì»¨í…ìŠ¤íŠ¸ ë¶„ì„
                const age = this.extractAge(text);
                if (age >= 60) {
                    if (text.includes('ëˆ') || text.includes('ë°›') || text.includes('ì§€ì›') || 
                        text.includes('ìˆ˜ë‹¹') || text.includes('í˜œíƒ') || text.includes('ìƒí™œ')) {
                        return 'elderly_financial';
                    }
                    if (text.includes('ì¼') || text.includes('ì¼ìë¦¬') || text.includes('ë²Œ')) {
                        return 'elderly_job';
                    }
                }
                
                // í‚¤ì›Œë“œ ê¸°ë°˜ ì¶”ê°€ ë¶„ì„
                if (text.includes('ê¸°ì´ˆ') && (text.includes('ì—°ê¸ˆ') || text.includes('ìˆ˜ê¸‰'))) {
                    return 'elderly_financial';
                }
                
                if (text.includes('ì°¨ìƒìœ„') || text.includes('í•œë¶€ëª¨') || text.includes('ì¥ì• ')) {
                    return 'financial_difficulty';
                }
                
                return null;
            },
            
            extractAge: function(text) {
                // í•œê¸€ ìˆ«ì - ë” ë§ì€ í‘œí˜„ ì¶”ê°€
                const koreanNums = {
                    'ì˜¤ì‹­': 50, 'ì˜¤ì‹­ì¼': 51, 'ì˜¤ì‹­ì´': 52, 'ì˜¤ì‹­ì‚¼': 53, 'ì˜¤ì‹­ì‚¬': 54, 'ì˜¤ì‹­ì˜¤': 55,
                    'ìœ¡ì‹­': 60, 'ìœ¡ì‹­ì¼': 61, 'ìœ¡ì‹­ì´': 62, 'ìœ¡ì‹­ì‚¼': 63, 'ìœ¡ì‹­ì‚¬': 64, 'ìœ¡ì‹­ì˜¤': 65,
                    'ìœ¡ì‹­ìœ¡': 66, 'ìœ¡ì‹­ì¹ ': 67, 'ìœ¡ì‹­íŒ”': 68, 'ìœ¡ì‹­êµ¬': 69,
                    'ì¹ ì‹­': 70, 'ì¹ ì‹­ì¼': 71, 'ì¹ ì‹­ì´': 72, 'ì¹ ì‹­ì‚¼': 73, 'ì¹ ì‹­ì‚¬': 74, 'ì¹ ì‹­ì˜¤': 75,
                    'íŒ”ì‹­': 80, 'íŒ”ì‹­ì¼': 81, 'íŒ”ì‹­ì´': 82, 'íŒ”ì‹­ì‚¼': 83, 'íŒ”ì‹­ì‚¬': 84, 'íŒ”ì‹­ì˜¤': 85,
                    'êµ¬ì‹­': 90,
                    'ì˜ˆìˆœ': 60, 'ì¼í”': 70, 'ì—¬ë“ ': 80, 'ì•„í”': 90,
                    'í™˜ê°‘': 60, 'ê³ í¬': 70, 'íŒ”ìˆœ': 80, 'êµ¬ìˆœ': 90
                };
                
                for (const [korean, num] of Object.entries(koreanNums)) {
                    if (text.includes(korean)) return num;
                }
                
                // ìˆ«ì
                const match = text.match(/(\d{2,3})(ì‚´|ì„¸|ëŒ€)/);
                if (match) return parseInt(match[1]);
                
                // "~ëŒ€" í‘œí˜„
                if (text.includes('60ëŒ€')) return 65;
                if (text.includes('70ëŒ€')) return 75;
                if (text.includes('80ëŒ€')) return 85;
                
                return 0;
            }
        };

        // ì‘ë‹µ ìƒì„±ê¸°
        const responseGenerator = {
            generate: function(type) {
                const responses = {
                    elderly_financial: `ì–´ë¥´ì‹ ê»˜ì„œ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆëŠ” ì§€ì›ì„ ì•ˆë‚´í•´ë“œë¦´ê²Œìš”! ğŸ˜Š

<strong>1ï¸âƒ£ ê¸°ì´ˆì—°ê¸ˆ</strong>
â€¢ ìê²©: ë§Œ 65ì„¸ ì´ìƒ, ì†Œë“ í•˜ìœ„ 70%
â€¢ ê¸ˆì•¡: ë§¤ë‹¬ ìµœëŒ€ 33ë§Œ 4ì²œì›
â€¢ ì‹ ì²­: ì£¼ë¯¼ì„¼í„° ë˜ëŠ” ë³µì§€ë¡œ(www.bokjiro.go.kr)

<strong>2ï¸âƒ£ ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì</strong>
â€¢ ìƒê³„ê¸‰ì—¬: ì›” ìµœëŒ€ 62ë§Œì›
â€¢ ì˜ë£Œê¸‰ì—¬: ë³‘ì›ë¹„ ì§€ì›
â€¢ ì£¼ê±°ê¸‰ì—¬: ì›”ì„¸/ì „ì„¸ ì§€ì›
â€¢ ì‹ ì²­: ì£¼ë¯¼ì„¼í„°

<strong>3ï¸âƒ£ ë…¸ì¸ì¼ìë¦¬ì‚¬ì—…</strong>
â€¢ ì›” 27ë§Œì›~71ë§Œì›
â€¢ í•˜ë£¨ 3-4ì‹œê°„ ê·¼ë¬´
â€¢ ì‹ ì²­: ì‹œë‹ˆì–´í´ëŸ½, ë…¸ì¸ë³µì§€ê´€

<strong>4ï¸âƒ£ ê¸°íƒ€ ì§€ì›</strong>
â€¢ ë…¸ì¸ëŒë´„ì„œë¹„ìŠ¤
â€¢ ë¬´ë£Œê¸‰ì‹
â€¢ ê²½ë¡œìš°ëŒ€(ì§€í•˜ì² , ê³µì› ë¬´ë£Œ)

ğŸ“ ìƒë‹´ì „í™”: 129 (ë³´ê±´ë³µì§€ìƒë‹´ì„¼í„°)
ì£¼ë¯¼ì„¼í„°ì—ì„œ í†µí•© ìƒë‹´ë°›ìœ¼ì‹œë©´ ë§ì¶¤ ì§€ì› ì•ˆë‚´ë°›ìœ¼ì‹¤ ìˆ˜ ìˆì–´ìš”!`,

                    elderly_job: `ì–´ë¥´ì‹ ì„ ìœ„í•œ ì¼ìë¦¬ ì •ë³´ì˜ˆìš”! ğŸ’ª

<strong>ğŸ‘´ ë…¸ì¸ì¼ìë¦¬ì‚¬ì—…</strong>

1ï¸âƒ£ <strong>ê³µìµí˜•</strong>
â€¢ ì›” 27ë§Œì› (ì›” 30ì‹œê°„)
â€¢ í™˜ê²½ì •ë¹„, ê¸‰ì‹ë„ìš°ë¯¸ ë“±
â€¢ ë§Œ 65ì„¸ ì´ìƒ ê¸°ì´ˆì—°ê¸ˆ ìˆ˜ê¸‰ì

2ï¸âƒ£ <strong>ì‚¬íšŒì„œë¹„ìŠ¤í˜•</strong>
â€¢ ì›” 59~71ë§Œì› (ì›” 60ì‹œê°„)
â€¢ ë…¸ë…¸ì¼€ì–´, ë³´ìœ¡ì‹œì„¤ ë„ìš°ë¯¸
â€¢ ë§Œ 65ì„¸ ì´ìƒ

3ï¸âƒ£ <strong>ì‹œì¥í˜•</strong>
â€¢ ê¸‰ì—¬ ì‚¬ì—…ë‹¨ë³„ ìƒì´
â€¢ ì¹´í˜, ì œì¡°, íŒë§¤ ë“±
â€¢ ë§Œ 60ì„¸ ì´ìƒ

<strong>ğŸ“ ì‹ ì²­ì²˜</strong>
â€¢ ì‹œë‹ˆì–´í´ëŸ½ (1566-0072)
â€¢ ë…¸ì¸ë³µì§€ê´€
â€¢ ëŒ€í•œë…¸ì¸íšŒ ì·¨ì—…ì§€ì›ì„¼í„°

ë§¤ë…„ 12~1ì›” ëª¨ì§‘í•˜ë‹ˆ ë¯¸ë¦¬ ì‹ ì²­í•˜ì„¸ìš”!`,

                    job_search: `ì¼ìë¦¬ë¥¼ ì°¾ê³  ê³„ì‹œëŠ”êµ°ìš”! ë„ì™€ë“œë¦´ê²Œìš” ğŸ’¼

<strong>ğŸ” ì¼ìë¦¬ ì°¾ê¸°</strong>

1ï¸âƒ£ <strong>ì •ë¶€ ì¼ìë¦¬ ì§€ì›</strong>
â€¢ ì›Œí¬ë„·: www.work.go.kr
â€¢ êµ­ë¯¼ì·¨ì—…ì§€ì›ì œë„: ì›” 50ë§Œì›+ì·¨ì—…ì§€ì›
â€¢ ê³ ìš©ì„¼í„° ì§ì—…ìƒë‹´

2ï¸âƒ£ <strong>ì¤‘ì¥ë…„ íŠ¹í™”</strong>
â€¢ ì¤‘ì¥ë…„ì¼ìë¦¬í¬ë§ì„¼í„°
â€¢ ì‹œë‹ˆì–´ì¸í„´ì‹­: ê¸°ì—… ì—°ìˆ˜ ì§€ì›
â€¢ ê²½ë ¥í™œìš© ì¼ìë¦¬

3ï¸âƒ£ <strong>ì¦‰ì‹œ ê°€ëŠ¥í•œ ì¼</strong>
â€¢ ê³µê³µê·¼ë¡œ: êµ¬ì²­/ì£¼ë¯¼ì„¼í„° ì‹ ì²­
â€¢ ìí™œê·¼ë¡œ: ê¸°ì´ˆìˆ˜ê¸‰ì ìš°ì„ 
â€¢ ì¼ìš©ì§: ê±´ì„¤í˜‘íšŒ, ì¸ë ¥ì‚¬ë¬´ì†Œ

ì–´ë–¤ ë¶„ì•¼ ê²½ë ¥ì´ ìˆìœ¼ì‹ ê°€ìš”?`,

                    financial_difficulty: `ê²½ì œì ìœ¼ë¡œ ì–´ë ¤ìš°ì‹  ìƒí™©ì´ì‹œêµ°ìš”. ë„ì™€ë“œë¦´ê²Œìš”!

<strong>ğŸ“Œ ì¦‰ì‹œ ì‹ ì²­ ê°€ëŠ¥í•œ ì§€ì›</strong>

1ï¸âƒ£ <strong>ê¸´ê¸‰ë³µì§€ì§€ì›</strong>
â€¢ ìƒê³„ì§€ì›: 4ì¸ ê¸°ì¤€ ì›” 162ë§Œì›
â€¢ ì˜ë£Œì§€ì›: 300ë§Œì› í•œë„
â€¢ ì£¼ê±°ì§€ì›: ì›”ì„¸ ì§€ì›
â€¢ ì‹ ì²­: ì£¼ë¯¼ì„¼í„° ë˜ëŠ” ë³´ê±´ë³µì§€ìƒë‹´ì„¼í„°(129)

2ï¸âƒ£ <strong>ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì</strong>
â€¢ ìƒê³„/ì˜ë£Œ/ì£¼ê±°/êµìœ¡ ê¸‰ì—¬
â€¢ ì‹ ì²­: ì£¼ë¯¼ì„¼í„°

3ï¸âƒ£ <strong>ì°¨ìƒìœ„ê³„ì¸µ ì§€ì›</strong>
â€¢ ì¤‘ìœ„ì†Œë“ 50% ì´í•˜ ê°€êµ¬
â€¢ ê°ì¢… ê°ë©´ í˜œíƒ

ì–´ë–¤ ê²ƒë¶€í„° ë„ì™€ë“œë¦´ê¹Œìš”?`,

                    housing: `ì£¼ê±° ì§€ì› ì •ë³´ë¥¼ ì•ˆë‚´í•´ë“œë¦´ê²Œìš” ğŸ 

<strong>ğŸ¢ ê³µê³µì„ëŒ€ì£¼íƒ</strong>

1ï¸âƒ£ <strong>ì˜êµ¬ì„ëŒ€</strong>
â€¢ ë³´ì¦ê¸ˆ 250ë§Œì›, ì›” 5~10ë§Œì›
â€¢ ê¸°ì´ˆìˆ˜ê¸‰ì, ì°¨ìƒìœ„ê³„ì¸µ

2ï¸âƒ£ <strong>êµ­ë¯¼ì„ëŒ€</strong>
â€¢ ì‹œì„¸ 60~80% ìˆ˜ì¤€
â€¢ ë¬´ì£¼íƒ ì €ì†Œë“ì¸µ

3ï¸âƒ£ <strong>í–‰ë³µì£¼íƒ</strong>
â€¢ ì Šì€ì¸µ, ì‹ í˜¼ë¶€ë¶€ ìš°ì„ 
â€¢ ì‹œì„¸ 60~80%

<strong>ğŸ’° ì£¼ê±°ê¸‰ì—¬</strong>
â€¢ ì›”ì„¸: ìµœëŒ€ 32ë§Œì› ì§€ì›
â€¢ ìê°€: ì£¼íƒ ìˆ˜ì„ ë¹„ ì§€ì›
â€¢ ì‹ ì²­: ì£¼ë¯¼ì„¼í„°

LH ì½œì„¼í„°: 1600-1004`,

                    medical: `ì˜ë£Œë¹„ ì§€ì› ì•ˆë‚´ë“œë¦´ê²Œìš” ğŸ¥

<strong>ğŸ’Š ì˜ë£Œë¹„ ì§€ì›ì œë„</strong>

1ï¸âƒ£ <strong>ì˜ë£Œê¸‰ì—¬</strong>
â€¢ ê¸°ì´ˆìˆ˜ê¸‰ì ë³‘ì›ë¹„ ì§€ì›
â€¢ ë³¸ì¸ë¶€ë‹´: ì™¸ë˜ 1000ì›, ì…ì› ë¬´ë£Œ

2ï¸âƒ£ <strong>ê¸´ê¸‰ì˜ë£Œë¹„ ì§€ì›</strong>
â€¢ ìµœëŒ€ 300ë§Œì›
â€¢ ê°‘ì‘ìŠ¤ëŸ° ì¤‘ë³‘/ìˆ˜ìˆ  ì‹œ

3ï¸âƒ£ <strong>ì¬ë‚œì ì˜ë£Œë¹„ ì§€ì›</strong>
â€¢ ì˜ë£Œë¹„ 50% ì§€ì› (ìµœëŒ€ 3ì²œë§Œì›)
â€¢ ì†Œë“ ëŒ€ë¹„ ì˜ë£Œë¹„ 15% ì´ˆê³¼ ì‹œ

4ï¸âƒ£ <strong>ê±´ê°•ë³´í—˜ë£Œ ê°ë©´</strong>
â€¢ ì‹¤ì§/íœ´ì§ ì‹œ 50% ê°ë©´
â€¢ ì‹ ì²­: ê±´ê°•ë³´í—˜ê³µë‹¨

ë„ì›€ì´ í•„ìš”í•˜ì‹  ì˜ë£Œ ìƒí™©ì´ ìˆìœ¼ì‹ ê°€ìš”?`,

                    childcare: `ìœ¡ì•„ ì§€ì› ì •ë³´ì˜ˆìš” ğŸ‘¶

<strong>ğŸ’° ì–‘ìœ¡ ì§€ì›ê¸ˆ</strong>

1ï¸âƒ£ <strong>ì•„ë™ìˆ˜ë‹¹</strong>
â€¢ ë§Œ 8ì„¸ ë¯¸ë§Œ: ì›” 10ë§Œì›

2ï¸âƒ£ <strong>ì–‘ìœ¡ìˆ˜ë‹¹</strong>
â€¢ ì–´ë¦°ì´ì§‘ ë¯¸ì´ìš©: ì›” 10~20ë§Œì›

3ï¸âƒ£ <strong>ë³´ìœ¡ë£Œ ì§€ì›</strong>
â€¢ ì–´ë¦°ì´ì§‘: ì „ì•¡ ì§€ì›
â€¢ ìœ ì¹˜ì›: ìœ ì•„í•™ë¹„ ì§€ì›

<strong>ğŸ« ëŒë´„ ì„œë¹„ìŠ¤</strong>
â€¢ ì•„ì´ëŒë´„ì„œë¹„ìŠ¤: ì‹œê°„ì œ/ì¢…ì¼ì œ
â€¢ ì´ˆë“±ëŒë´„êµì‹¤
â€¢ ì§€ì—­ì•„ë™ì„¼í„°

ì‹ ì²­: ì£¼ë¯¼ì„¼í„° ë˜ëŠ” ë³µì§€ë¡œ`,

                    moving: `ì´ì‚¬í•˜ì…¨êµ°ìš”! í•„ìˆ˜ ì‹ ê³ ì‚¬í•­ ì•ˆë‚´ë“œë¦´ê²Œìš”.

<strong>ğŸ“‹ ì „ì…ì‹ ê³  (í•„ìˆ˜!)</strong>
â€¢ ê¸°í•œ: ì´ì‚¬ í›„ 14ì¼ ì´ë‚´
â€¢ ì¥ì†Œ: ìƒˆ ì£¼ì†Œì§€ ì£¼ë¯¼ì„¼í„°
â€¢ ì¤€ë¹„ë¬¼: ì‹ ë¶„ì¦, ì„ëŒ€ì°¨ê³„ì•½ì„œ(ì„¸ì…ì)
â€¢ ì˜¨ë¼ì¸: ì •ë¶€24(www.gov.kr)

<strong>ğŸ’¡ í•¨ê»˜ ì²˜ë¦¬í•˜ë©´ ì¢‹ì€ ê²ƒë“¤</strong>
â€¢ í™•ì •ì¼ì (ì„¸ì…ì ë³´í˜¸)
â€¢ ìë™ì°¨ ì£¼ì†Œë³€ê²½
â€¢ ê°ì¢… ì¹´ë“œ/ë³´í—˜ ì£¼ì†Œë³€ê²½

ë²Œê¸ˆ í”¼í•˜ë ¤ë©´ ê¼­ 14ì¼ ì•ˆì— ì‹ ê³ í•˜ì„¸ìš”!`,

                    birth: `ì¶•í•˜ë“œë¦½ë‹ˆë‹¤! ğŸ‘¶

<strong>ì¶œìƒì‹ ê³  & ì§€ì›ê¸ˆ ì•ˆë‚´</strong>

1ï¸âƒ£ <strong>ì¶œìƒì‹ ê³ </strong>
â€¢ ê¸°í•œ: ì¶œìƒ í›„ 1ê°œì›” ì´ë‚´
â€¢ ì¥ì†Œ: ì£¼ë¯¼ì„¼í„°
â€¢ ì¤€ë¹„ë¬¼: ì¶œìƒì¦ëª…ì„œ, ë¶€ëª¨ ì‹ ë¶„ì¦

2ï¸âƒ£ <strong>ì¶œì‚°ì§€ì›ê¸ˆ</strong>
â€¢ ì²«ë§Œë‚¨ì´ìš©ê¶Œ: 200ë§Œì›
â€¢ ì¶œì‚°ì¥ë ¤ê¸ˆ: ì§€ìì²´ë³„ ìƒì´
â€¢ ì–‘ìœ¡ìˆ˜ë‹¹: ì›” 20ë§Œì›
â€¢ ì•„ë™ìˆ˜ë‹¹: ì›” 10ë§Œì›

3ï¸âƒ£ <strong>ì‚°í›„ì¡°ë¦¬ ì§€ì›</strong>
â€¢ ì‚°ëª¨ì‹ ìƒì•„ ê±´ê°•ê´€ë¦¬ì‚¬
â€¢ ì‚°í›„ì¡°ë¦¬ì› ë¹„ìš© ì§€ì›

ì£¼ë¯¼ì„¼í„°ì—ì„œ í•œë²ˆì— ì‹ ì²­ ê°€ëŠ¥í•´ìš”!`,

                    document: `í•„ìš”í•œ ì„œë¥˜ ë°œê¸‰ ë°©ë²•ì„ ì•ˆë‚´í•´ë“œë¦´ê²Œìš”!

<strong>ğŸ“„ ì£¼ìš” ì„œë¥˜ ë°œê¸‰ì²˜</strong>

â€¢ <strong>ì£¼ë¯¼ë“±ë¡ë“±ë³¸/ì´ˆë³¸</strong>
  - ì£¼ë¯¼ì„¼í„°: 400ì›
  - ë¬´ì¸ë°œê¸‰ê¸°: 300ì›
  - ì •ë¶€24: ë¬´ë£Œ

â€¢ <strong>ê°€ì¡±ê´€ê³„ì¦ëª…ì„œ</strong>
  - ì£¼ë¯¼ì„¼í„°: 1,000ì›
  - ì˜¨ë¼ì¸: 500ì›

â€¢ <strong>ì¸ê°ì¦ëª…ì„œ</strong>
  - ì£¼ë¯¼ì„¼í„° ì§ì ‘ë°©ë¬¸ í•„ìˆ˜

ì˜¨ë¼ì¸ì´ ì œì¼ ì‹¸ê³  í¸í•´ìš”!`,

                    passport: `ì—¬ê¶Œ ë°œê¸‰ ì•ˆë‚´ë“œë¦´ê²Œìš”! âœˆï¸

<strong>ğŸ“Œ ì—¬ê¶Œ ë°œê¸‰</strong>
â€¢ ì¥ì†Œ: êµ¬ì²­/ì‹œì²­ ì—¬ê¶Œê³¼
â€¢ ì¤€ë¹„ë¬¼: ì‹ ë¶„ì¦, ì—¬ê¶Œì‚¬ì§„ 1ë§¤
â€¢ ìˆ˜ìˆ˜ë£Œ: 5ë§Œì› (10ë…„)
â€¢ ì†Œìš”ê¸°ê°„: ì•½ 1ì£¼ì¼

<strong>ğŸ’¡ ì˜¨ë¼ì¸ ì‹ ì²­</strong>
â€¢ ì •ë¶€24ì—ì„œ ì‹ ì²­ â†’ ë°©ë¬¸ìˆ˜ë ¹
â€¢ ê¸´ê¸‰ì—¬ê¶Œ: 1ì¼ ë°œê¸‰ (1ë…„ë§Œ ìœ íš¨)

ì—¬ê¶Œì‚¬ì§„ì€ 6ê°œì›” ì´ë‚´ ì´¬ì˜í•œ ê²ƒë§Œ ê°€ëŠ¥í•´ìš”!`,

                    default: `ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”? ğŸ˜Š

êµ¬ì²´ì ìœ¼ë¡œ ë§ì”€í•´ì£¼ì‹œë©´ ì •í™•íˆ ì•ˆë‚´í•´ë“œë¦´ê²Œìš”.
ì˜ˆ: "ê¸°ì´ˆì—°ê¸ˆ ì‹ ì²­", "ì´ì‚¬ ì‹ ê³ ", "ìƒí™œë¹„ ì§€ì›" ë“±`
                };
                
                return responses[type] || responses.default;
            }
        };

        // RAG ì‹œìŠ¤í…œ - ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰
        async function searchRAG(query) {
            if (!ragConfig.enabled) return null;
            
            try {
                // ì‹¤ì œ êµ¬í˜„ì‹œ ë²¡í„° DB API í˜¸ì¶œ
                // ì—¬ê¸°ì„œëŠ” ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° ë°˜í™˜
                const mockResults = {
                    laws: [
                        { title: 'ê¸°ì´ˆì—°ê¸ˆë²•', content: '65ì„¸ ì´ìƒ ì†Œë“í•˜ìœ„ 70%...', score: 0.92 },
                        { title: 'ê¸´ê¸‰ë³µì§€ì§€ì›ë²•', content: 'ìœ„ê¸°ìƒí™© ê¸´ê¸‰ì§€ì›...', score: 0.88 }
                    ],
                    faqs: [
                        { question: 'ê¸°ì´ˆì—°ê¸ˆ ì‹ ì²­ ìê²©ì€?', answer: 'ë§Œ 65ì„¸ ì´ìƒ, ì†Œë“í•˜ìœ„ 70%...', score: 0.95 }
                    ],
                    cases: [
                        { id: 'CASE-2024-001', summary: 'ìœ ì‚¬ ì‚¬ë¡€ ì²˜ë¦¬ ê²°ê³¼...', score: 0.9 }
                    ]
                };
                
                const searchResults = {};
                for (const [key, results] of Object.entries(mockResults)) {
                    searchResults[key] = results.filter(r => r.score >= ragConfig.threshold);
                }
                
                return searchResults;
            } catch (error) {
                console.error('RAG ê²€ìƒ‰ ì˜¤ë¥˜:', error);
                return null;
            }
        }

        // ë¡œì»¬ SLM í˜¸ì¶œ (ë¯¼ê°ì •ë³´ í¬í•¨ ì‹œ)
        async function callLocalSLM(input, context) {
            try {
                const response = await fetch(apiConfig.localSLMEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gemma-2b',
                        messages: [
                            {
                                role: 'system',
                                content: `ë‹¹ì‹ ì€ í•œêµ­ ì •ë¶€ ë¯¼ì›ì²˜ë¦¬ AIì…ë‹ˆë‹¤.
ë¯¼ê°ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•˜ë©° ì •í™•í•œ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
ì»¨í…ìŠ¤íŠ¸: ${context ? JSON.stringify(context) : 'ì—†ìŒ'}`
                            },
                            {
                                role: 'user',
                                content: input
                            }
                        ],
                        max_tokens: 1000,
                        temperature: 0.3
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return {
                        content: data.choices[0].message.content,
                        source: 'local_slm'
                    };
                }
            } catch (error) {
                console.error('ë¡œì»¬ SLM í˜¸ì¶œ ì‹¤íŒ¨:', error);
            }
            return null;
        }

        // í´ë¼ìš°ë“œ API í˜¸ì¶œ
        async function callAPI(input, context) {
            if (!apiConfig.useAPI) return null;
            
            try {
                if (apiConfig.provider === 'openai') {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiConfig.apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4-turbo-preview',
                            messages: [
                                {
                                    role: 'system',
                                    content: `ë‹¹ì‹ ì€ ì¹œì ˆí•œ í•œêµ­ ë¯¼ì›ì²˜ë¦¬ ì „ë¬¸ ìƒë‹´ì‚¬ì…ë‹ˆë‹¤.
ì‹œë¯¼ë“¤ì´ ì¼ìƒì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  í‘œí˜„ì„ ì´í•´í•˜ê³ , ëˆˆë†’ì´ì— ë§ì¶° ì¹œê·¼í•˜ê²Œ ì•ˆë‚´í•©ë‹ˆë‹¤.

í•µì‹¬ ì—­í• :
1. ì‹œë¯¼ì˜ ë§ì„ ìˆëŠ” ê·¸ëŒ€ë¡œ ì´í•´í•˜ê¸° (êµ¬ì–´ì²´, ì‚¬íˆ¬ë¦¬, ì†ì–´ ëª¨ë‘ ì´í•´)
2. ì‹¤ì œ ê³µë¬´ì›ì²˜ëŸ¼ ì¹œì ˆí•˜ê³  ê³µê°í•˜ëŠ” ì‘ëŒ€
3. ë³µì¡í•œ ì œë„ë¥¼ ì‰½ê²Œ ì„¤ëª…
4. êµ¬ì²´ì ì¸ ì •ë³´ ì œê³µ (ê¸ˆì•¡, ì‹ ì²­ì²˜, ê¸°í•œ ë“±)
5. HTML íƒœê·¸ í™œìš© (<strong>, <br> ë“±)
6. ì´ëª¨ì§€ë¡œ ì¹œê·¼ê° í‘œí˜„

ëŒ€í™” ì´í•´ ê·œì¹™:
- "ìœ¡ì‹­ì´ ë„˜ì—ˆëŠ”ë°" = 62ì„¸ ì´ìƒ ì–´ë¥´ì‹ 
- "ëˆ ë°›ì„ ìˆ˜ ìˆëŠ”ê±°" = ì§€ì›ê¸ˆ, ìˆ˜ë‹¹, í˜œíƒ
- "ë‚˜ì´ê°€ ì¢€ ìˆëŠ”ë°" = ê³ ë ¹ì
- "ëˆì„ ë²Œ ìˆ˜ ìˆëŠ” ìˆ˜ë‹¨ì´ ì—†ì–´" = ì¼ìë¦¬ë‚˜ ìƒê³„ ì§€ì› í•„ìš”
- "ìƒí™œì´ í˜ë“¤ì–´" = ê²½ì œì  ì–´ë ¤ì›€
- "ë¨¹ê³  ì‚´ê¸° ë¹ ë“¯í•´" = ìƒí™œë¹„ ë¶€ì¡±

ì£¼ìš” ë¯¼ì› ì •ë³´:
1. ë…¸ì¸ ì§€ì›
   - ê¸°ì´ˆì—°ê¸ˆ: 65ì„¸ ì´ìƒ, ì†Œë“í•˜ìœ„ 70%, ì›” ìµœëŒ€ 33.4ë§Œì›
   - ë…¸ì¸ì¼ìë¦¬: 60-65ì„¸ ì´ìƒ, ì›” 27-71ë§Œì›
   - ê¸°ì´ˆìƒí™œìˆ˜ê¸‰: ìƒê³„/ì˜ë£Œ/ì£¼ê±°ê¸‰ì—¬
   
2. ìƒí™œ ì§€ì›
   - ê¸´ê¸‰ë³µì§€: ê°‘ì‘ìŠ¤ëŸ° ìœ„ê¸° ì‹œ ìƒê³„/ì˜ë£Œ/ì£¼ê±° ì§€ì›
   - ì°¨ìƒìœ„ê³„ì¸µ: ì¤‘ìœ„ì†Œë“ 50% ì´í•˜ ê°ì¢… ê°ë©´
   
3. ì¼ìë¦¬
   - ì •ë¶€ ì¼ìë¦¬: ê³µê³µê·¼ë¡œ, ìí™œê·¼ë¡œ
   - ë…¸ì¸ì¼ìë¦¬ì‚¬ì—…: ê³µìµí˜•/ì‚¬íšŒì„œë¹„ìŠ¤í˜•/ì‹œì¥í˜•
   
4. í–‰ì • ì„œë¹„ìŠ¤
   - ì „ì…ì‹ ê³ : ì´ì‚¬ í›„ 14ì¼ ì´ë‚´
   - ì¶œìƒì‹ ê³ : ì¶œìƒ í›„ 1ê°œì›” ì´ë‚´
   - ê°ì¢… ì¦ëª…ì„œ: ì •ë¶€24 ì˜¨ë¼ì¸ ë°œê¸‰

ëŒ€í™” ìŠ¤íƒ€ì¼:
- ì‹œì‘: "ë„¤, ì–´ë¥´ì‹ !" ë˜ëŠ” "ì•ˆë…•í•˜ì„¸ìš”!"
- ê³µê°: "í˜ë“œì‹  ìƒí™©ì´ì‹œêµ°ìš”" "ë„ì™€ë“œë¦´ê²Œìš”"
- ì„¤ëª…: ë‹¨ê³„ë³„ë¡œ ì‰½ê²Œ
- ë§ˆë¬´ë¦¬: "ì£¼ë¯¼ì„¼í„°ì—ì„œ ìƒë‹´ë°›ì•„ë³´ì„¸ìš”"

ì‹¤ì œ ëŒ€í™” ì˜ˆì‹œ:
Q: "ìœ¡ì‹­ì´ ë„˜ì—ˆëŠ”ë° ëˆ ë°›ì„ ìˆ˜ ìˆëŠ”ê±° ë­ ì—†ëƒ"
A: ë„¤, ì–´ë¥´ì‹ ! 62ì„¸ì‹œë©´ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆëŠ” ì§€ì›ì´ ì—¬ëŸ¬ ê°€ì§€ ìˆì–´ìš”! ğŸ˜Š

ìš°ì„  ë§Œ 65ì„¸ê°€ ë˜ì‹œë©´ <strong>ê¸°ì´ˆì—°ê¸ˆ</strong>ì„ ì‹ ì²­í•˜ì‹¤ ìˆ˜ ìˆì–´ìš”.
ë§¤ë‹¬ ìµœëŒ€ 33ë§Œì›ê¹Œì§€ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì§€ê¸ˆ ë‹¹ì¥ì€ <strong>ë…¸ì¸ì¼ìë¦¬ì‚¬ì—…</strong>ì— ì°¸ì—¬í•˜ì‹¤ ìˆ˜ ìˆì–´ìš”!
- ê³µìµí˜•: ì›” 27ë§Œì› (í•˜ë£¨ 3ì‹œê°„)
- ì‚¬íšŒì„œë¹„ìŠ¤í˜•: ì›” 59-71ë§Œì›

ìƒí™œì´ ë§ì´ ì–´ë ¤ìš°ì‹œë‹¤ë©´ <strong>ê¸°ì´ˆìƒí™œìˆ˜ê¸‰</strong>ì´ë‚˜ 
<strong>ê¸´ê¸‰ë³µì§€ì§€ì›</strong>ë„ ì‹ ì²­ ê°€ëŠ¥í•´ìš”.

ê°€ê¹Œìš´ ì£¼ë¯¼ì„¼í„°ì— ê°€ì‹œë©´ í•œë²ˆì— ìƒë‹´ë°›ìœ¼ì‹¤ ìˆ˜ ìˆì–´ìš”!
ë” ìì„¸í•œ ë‚´ìš©ì´ í•„ìš”í•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”~`
                                },
                                {
                                    role: 'user',
                                    content: input
                                }
                            ],
                            max_tokens: 1500,
                            temperature: 0.8
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        return data.choices[0].message.content;
                    }
                } else if (apiConfig.provider === 'google') {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiConfig.apiKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: `ë‹¹ì‹ ì€ ì¹œì ˆí•œ í•œêµ­ ë¯¼ì›ì²˜ë¦¬ ì „ë¬¸ ìƒë‹´ì‚¬ì…ë‹ˆë‹¤.

ì‹œë¯¼ì˜ ì§ˆë¬¸: "${input}"

ì¤‘ìš”: ì‹œë¯¼ë“¤ì€ ë‹¤ì–‘í•œ ë°©ì‹ìœ¼ë¡œ ë§í•©ë‹ˆë‹¤.
- "ìœ¡ì‹­ì´ ë„˜ì—ˆëŠ”ë° ëˆ ë°›ì„ ìˆ˜ ìˆëŠ”ê±° ë­ ì—†ëƒ" = 62ì„¸ ì´ìƒ ë…¸ì¸ ì§€ì›ê¸ˆ ë¬¸ì˜
- "ë‚˜ì´ê°€ ì¢€ ìˆëŠ”ë° ëˆì„ ë²Œ ìˆ˜ ìˆëŠ” ìˆ˜ë‹¨ì´ ì—†ì–´" = ê³ ë ¹ì ì¼ìë¦¬/ìƒê³„ ì§€ì›
- "ìƒí™œì´ í˜ë“¤ì–´", "ë¨¹ê³  ì‚´ê¸° ë¹ ë“¯í•´" = ê²½ì œì  ì§€ì› í•„ìš”

ë‹µë³€ ìŠ¤íƒ€ì¼:
1. êµ¬ì–´ì²´ë¥¼ ì™„ë²½íˆ ì´í•´í•˜ê³  ê³µê°ìœ¼ë¡œ ì‹œì‘
2. "ë„¤, ì–´ë¥´ì‹ !" "í˜ë“œì‹  ìƒí™©ì´ì‹œêµ°ìš”" ë“± ì¹œê·¼í•œ ì¸ì‚¬
3. HTML íƒœê·¸ë¡œ ì¤‘ìš” ë‚´ìš© ê°•ì¡° (<strong>, <br>)
4. ì´ëª¨ì§€ë¡œ ë”°ëœ»í•¨ í‘œí˜„ ğŸ˜Š
5. êµ¬ì²´ì  ì •ë³´ ì œê³µ (ê¸ˆì•¡, ì‹ ì²­ì²˜, ê¸°í•œ)

í•µì‹¬ ì •ë³´:
ë…¸ì¸ ì§€ì›:
- ê¸°ì´ˆì—°ê¸ˆ: 65ì„¸â†‘, ì›” ìµœëŒ€ 33.4ë§Œì›
- ë…¸ì¸ì¼ìë¦¬: 60ì„¸â†‘, ì›” 27-71ë§Œì›
- ê²½ë¡œìš°ëŒ€: ì§€í•˜ì² /ë²„ìŠ¤ ë¬´ë£Œ

ìƒí™œ ì§€ì›:
- ê¸°ì´ˆìƒí™œìˆ˜ê¸‰: ìƒê³„/ì˜ë£Œ/ì£¼ê±°/êµìœ¡ê¸‰ì—¬
- ê¸´ê¸‰ë³µì§€: ìœ„ê¸° ì‹œ ì¦‰ì‹œ ì§€ì›
- ì°¨ìƒìœ„ê³„ì¸µ: ì¤‘ìœ„ì†Œë“ 50% ì´í•˜

ì¼ìë¦¬:
- ë…¸ì¸ì¼ìë¦¬ì‚¬ì—…: ê³µìµí˜•/ì‚¬íšŒì„œë¹„ìŠ¤í˜•
- ì¤‘ì¥ë…„ ì·¨ì—…: ì‹œë‹ˆì–´ì¸í„´ì‹­
- ê³µê³µê·¼ë¡œ: êµ¬ì²­/ì£¼ë¯¼ì„¼í„°

ì˜ˆì‹œ ë‹µë³€:
"ë„¤, ì–´ë¥´ì‹ ! 62ì„¸ì‹œë©´ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆëŠ” ì§€ì›ì´ ì—¬ëŸ¬ ê°€ì§€ ìˆì–´ìš”! ğŸ˜Š

<strong>ë‹¹ì¥ ê°€ëŠ¥í•œ ì§€ì›:</strong>
â€¢ ë…¸ì¸ì¼ìë¦¬ì‚¬ì—… (ì›” 27-71ë§Œì›)
â€¢ ìƒí™œ ì–´ë ¤ìš°ì‹œë©´ ê¸´ê¸‰ë³µì§€ì§€ì›

<strong>65ì„¸ ë˜ì‹œë©´:</strong>
â€¢ ê¸°ì´ˆì—°ê¸ˆ (ì›” ìµœëŒ€ 33ë§Œì›)

ì£¼ë¯¼ì„¼í„°ì—ì„œ í†µí•©ìƒë‹´ ë°›ì•„ë³´ì„¸ìš”!"

ìœ„ ìŠ¤íƒ€ì¼ëŒ€ë¡œ ì¹œê·¼í•˜ê³  ë„ì›€ë˜ëŠ” ë‹µë³€ì„ ì‘ì„±í•˜ì„¸ìš”.`
                                }]
                            }]
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        return data.candidates[0].content.parts[0].text;
                    }
                }
            } catch (error) {
                console.error('API Error:', error);
            }
            
            return null;
        }

        // ë¹ ë¥¸ ë©”ë‰´ ì¹´í…Œê³ ë¦¬ ì²˜ë¦¬
        function handleQuickMenu(category) {
            // ì‚¬ìš©ì ë©”ì‹œì§€ë¡œ í‘œì‹œ
            addChatMessage(`${category} ì •ë³´ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”`, 'user');
            
            // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
            showTypingIndicator();
            
            // ì¹´í…Œê³ ë¦¬ë³„ ì‘ë‹µ
            let response = '';
            switch(category) {
                case 'ë…¸ì¸ë³µì§€':
                    response = responseGenerator.generate('elderly_financial');
                    break;
                case 'ìƒí™œì§€ì›':
                    response = responseGenerator.generate('financial_difficulty');
                    break;
                case 'ì£¼ê±°ë³µì§€':
                    response = responseGenerator.generate('housing');
                    break;
                case 'ì˜ë£Œì§€ì›':
                    response = responseGenerator.generate('medical');
                    break;
                case 'ì¼ìë¦¬':
                    response = responseGenerator.generate('job_search');
                    break;
                default:
                    response = `${category}ì— ëŒ€í•œ ì •ë³´ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...`;
            }
            
            setTimeout(() => {
                hideTypingIndicator();
                addChatMessage(response, 'bot');
            }, 500);
        }
        
        // ë¹ ë¥¸ ì„œë¹„ìŠ¤ ë²„íŠ¼ ì²˜ë¦¬
        function handleQuickService(service) {
            // ì‚¬ìš©ì ë©”ì‹œì§€ë¡œ í‘œì‹œ
            addChatMessage(`${service}ì— ëŒ€í•´ ì•Œë ¤ì£¼ì„¸ìš”`, 'user');
            
            // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
            showTypingIndicator();
            
            // ì„œë¹„ìŠ¤ë³„ ì‘ë‹µ
            let response = '';
            switch(service) {
                case 'ê¸°ì´ˆì—°ê¸ˆ':
                    response = `<strong>ğŸ¯ ê¸°ì´ˆì—°ê¸ˆ ì•ˆë‚´</strong>

<strong>ì‹ ì²­ ìê²©</strong>
â€¢ ë§Œ 65ì„¸ ì´ìƒ ëŒ€í•œë¯¼êµ­ êµ­ë¯¼
â€¢ ì†Œë“ì¸ì •ì•¡ì´ ì„ ì •ê¸°ì¤€ì•¡ ì´í•˜
â€¢ ë‹¨ë…ê°€êµ¬: 213ë§Œì› ì´í•˜
â€¢ ë¶€ë¶€ê°€êµ¬: 340.8ë§Œì› ì´í•˜

<strong>ì§€ê¸‰ ê¸ˆì•¡</strong>
â€¢ ë‹¨ë…ê°€êµ¬: ì›” ìµœëŒ€ 334,810ì›
â€¢ ë¶€ë¶€ê°€êµ¬: ì›” ìµœëŒ€ 535,680ì›

<strong>ì‹ ì²­ ë°©ë²•</strong>
â€¢ ë°©ë¬¸: ì£¼ì†Œì§€ ìë©´ë™ ì£¼ë¯¼ì„¼í„°
â€¢ ì˜¨ë¼ì¸: ë³µì§€ë¡œ (www.bokjiro.go.kr)
â€¢ ëŒ€ë¦¬ì‹ ì²­ ê°€ëŠ¥ (ë°°ìš°ì, ìë…€ ë“±)

<strong>í•„ìš” ì„œë¥˜</strong>
â€¢ ì‹ ë¶„ì¦
â€¢ í†µì¥ì‚¬ë³¸
â€¢ ì†Œë“ì¬ì‚° ì‹ ê³ ì„œ

ğŸ“ ë¬¸ì˜: 129 ë˜ëŠ” êµ­ë¯¼ì—°ê¸ˆê³µë‹¨ 1355`;
                    break;
                    
                case 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰':
                    response = `<strong>ğŸ“‹ ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì ì•ˆë‚´</strong>

<strong>ê¸‰ì—¬ ì¢…ë¥˜</strong>
â€¢ ìƒê³„ê¸‰ì—¬: ì›” ìµœëŒ€ 62ë§Œì› (1ì¸ ê¸°ì¤€)
â€¢ ì˜ë£Œê¸‰ì—¬: ì˜ë£Œë¹„ ì§€ì›
â€¢ ì£¼ê±°ê¸‰ì—¬: ì„ì°¨ë£Œ ë˜ëŠ” ìˆ˜ì„ ìœ ì§€ë¹„
â€¢ êµìœ¡ê¸‰ì—¬: êµìœ¡í™œë™ì§€ì›ë¹„

<strong>ì„ ì • ê¸°ì¤€ (2024ë…„)</strong>
â€¢ ìƒê³„ê¸‰ì—¬: ì¤‘ìœ„ì†Œë“ 32% ì´í•˜
â€¢ ì˜ë£Œê¸‰ì—¬: ì¤‘ìœ„ì†Œë“ 40% ì´í•˜
â€¢ ì£¼ê±°ê¸‰ì—¬: ì¤‘ìœ„ì†Œë“ 48% ì´í•˜
â€¢ êµìœ¡ê¸‰ì—¬: ì¤‘ìœ„ì†Œë“ 50% ì´í•˜

<strong>ì‹ ì²­ ë°©ë²•</strong>
â€¢ ì£¼ì†Œì§€ ìë©´ë™ ì£¼ë¯¼ì„¼í„° ë°©ë¬¸
â€¢ ì˜¨ë¼ì¸: ë³µì§€ë¡œ (www.bokjiro.go.kr)

<strong>í•„ìš” ì„œë¥˜</strong>
â€¢ ì‹ ë¶„ì¦
â€¢ ì„ëŒ€ì°¨ê³„ì•½ì„œ (í•´ë‹¹ì)
â€¢ í†µì¥ì‚¬ë³¸

ğŸ’¡ í†µí•© ì‹ ì²­í•˜ë©´ ëª¨ë“  ê¸‰ì—¬ í•œë²ˆì— ì‹¬ì‚¬!`;
                    break;
                    
                case 'ê¸´ê¸‰ë³µì§€':
                    response = `<strong>ğŸš¨ ê¸´ê¸‰ë³µì§€ì§€ì› ì•ˆë‚´</strong>

<strong>ì§€ì› ëŒ€ìƒ</strong>
â€¢ ê°‘ì‘ìŠ¤ëŸ° ìœ„ê¸°ìƒí™©ìœ¼ë¡œ ìƒê³„ìœ ì§€ ê³¤ë€
â€¢ ì£¼ì†Œë“ì ì‚¬ë§, ê°€ì¶œ, í–‰ë°©ë¶ˆëª…
â€¢ ì¤‘í•œ ì§ˆë³‘ ë˜ëŠ” ë¶€ìƒ
â€¢ í™”ì¬, ìì—°ì¬í•´ ë“±

<strong>ì§€ì› ë‚´ìš©</strong>
â€¢ ìƒê³„ì§€ì›: 4ì¸ ê¸°ì¤€ ì›” 162ë§Œì›
â€¢ ì˜ë£Œì§€ì›: 300ë§Œì› í•œë„
â€¢ ì£¼ê±°ì§€ì›: 4ì¸ ê¸°ì¤€ ì›” 66ë§Œì›
â€¢ êµìœ¡ì§€ì›: í•™ìš©í’ˆë¹„, ìˆ˜ì—…ë£Œ

<strong>ì‹ ì²­ ë°©ë²•</strong>
â€¢ ë³´ê±´ë³µì§€ìƒë‹´ì„¼í„° 129 (24ì‹œê°„)
â€¢ ìë©´ë™ ì£¼ë¯¼ì„¼í„°
â€¢ ì‹œêµ°êµ¬ì²­

<strong>ì§€ì› ê¸°ê°„</strong>
â€¢ ìƒê³„: ìµœëŒ€ 6ê°œì›”
â€¢ ì˜ë£Œ: 1íšŒ (í•„ìš”ì‹œ ì—°ì¥)
â€¢ ì£¼ê±°: ìµœëŒ€ 12ê°œì›”

âš¡ ìœ„ê¸°ìƒí™© ë°œìƒì‹œ ì¦‰ì‹œ 129ë¡œ ì „í™”!`;
                    break;
                    
                case 'ì „ì…ì‹ ê³ ':
                    response = `<strong>ğŸ  ì „ì…ì‹ ê³  ì•ˆë‚´</strong>

<strong>ì‹ ê³  ê¸°í•œ</strong>
â€¢ ì´ì‚¬í•œ ë‚ ë¡œë¶€í„° 14ì¼ ì´ë‚´ (í•„ìˆ˜!)
â€¢ ê¸°í•œ ì´ˆê³¼ì‹œ ê³¼íƒœë£Œ ìµœëŒ€ 5ë§Œì›

<strong>ì‹ ê³  ë°©ë²•</strong>
â€¢ ë°©ë¬¸: ìƒˆ ì£¼ì†Œì§€ ìë©´ë™ ì£¼ë¯¼ì„¼í„°
â€¢ ì˜¨ë¼ì¸: ì •ë¶€24 (www.gov.kr)
â€¢ ë¬´ì¸ë¯¼ì›ë°œê¸‰ê¸°

<strong>í•„ìš” ì„œë¥˜</strong>
â€¢ ì‹ ë¶„ì¦
â€¢ ì„¸ëŒ€ì£¼ ë„ì¥ (ë³¸ì¸ ì•„ë‹ ê²½ìš°)
â€¢ ì„ëŒ€ì°¨ê³„ì•½ì„œ (ì„¸ì…ì)

<strong>í•¨ê»˜ ì²˜ë¦¬í•˜ë©´ ì¢‹ì€ ê²ƒ</strong>
â€¢ í™•ì •ì¼ì (ì „ì„¸/ì›”ì„¸ ë³´í˜¸)
â€¢ ìë™ì°¨ ì£¼ì†Œë³€ê²½
â€¢ ê°ì¢… ì¹´ë“œ/ë³´í—˜ ì£¼ì†Œë³€ê²½

ğŸ’¡ ì˜¨ë¼ì¸ ì‹ ê³ ê°€ ê°€ì¥ ë¹ ë¥´ê³  í¸ë¦¬í•´ìš”!`;
                    break;
                    
                case 'ì£¼ë¯¼ë“±ë¡ë“±ë³¸':
                    response = `<strong>ğŸ“„ ì£¼ë¯¼ë“±ë¡ë“±ë³¸ ë°œê¸‰ ì•ˆë‚´</strong>

<strong>ë°œê¸‰ ë°©ë²• ë° ìˆ˜ìˆ˜ë£Œ</strong>
â€¢ ì˜¨ë¼ì¸ ì •ë¶€24: ë¬´ë£Œ âœ¨
â€¢ ë¬´ì¸ë¯¼ì›ë°œê¸‰ê¸°: 300ì›
â€¢ ì£¼ë¯¼ì„¼í„° ë°©ë¬¸: 400ì›

<strong>ì˜¨ë¼ì¸ ë°œê¸‰ (ì¶”ì²œ!)</strong>
â€¢ ì •ë¶€24 (www.gov.kr)
â€¢ 24ì‹œê°„ ë°œê¸‰ ê°€ëŠ¥
â€¢ í”„ë¦°í„°ë¡œ ì¦‰ì‹œ ì¶œë ¥

<strong>ë¬´ì¸ë°œê¸‰ê¸° ìœ„ì¹˜</strong>
â€¢ ì£¼ë¯¼ì„¼í„°, êµ¬ì²­, ì§€í•˜ì² ì—­
â€¢ ëŒ€í˜•ë§ˆíŠ¸, ì€í–‰

<strong>í•„ìš”í•œ ê²½ìš°</strong>
â€¢ ì€í–‰ ëŒ€ì¶œ
â€¢ ë¶€ë™ì‚° ê³„ì•½
â€¢ ê°ì¢… ì¦ëª…

ğŸ’¡ ì •ë¶€24ì—ì„œ ë¬´ë£Œë¡œ ë°œê¸‰ë°›ìœ¼ì„¸ìš”!
ì „ìë¬¸ì„œì§€ê°‘ì— ì €ì¥í•˜ë©´ ë” í¸ë¦¬í•´ìš”.`;
                    break;
                    
                case 'ì—¬ê¶Œë°œê¸‰':
                    response = `<strong>âœˆï¸ ì—¬ê¶Œ ë°œê¸‰ ì•ˆë‚´</strong>

<strong>ë°œê¸‰ ì¥ì†Œ</strong>
â€¢ ì „êµ­ ì—¬ê¶Œì‚¬ë¬´ ëŒ€í–‰ê¸°ê´€
â€¢ êµ¬ì²­, ì‹œì²­ ë¯¼ì›ì‹¤

<strong>í•„ìš” ì„œë¥˜</strong>
â€¢ ì—¬ê¶Œë°œê¸‰ì‹ ì²­ì„œ
â€¢ ì‹ ë¶„ì¦
â€¢ ì—¬ê¶Œì‚¬ì§„ 1ë§¤ (6ê°œì›” ì´ë‚´)
â€¢ ë³‘ì—­ê´€ë ¨ ì„œë¥˜ (í•´ë‹¹ì)

<strong>ìˆ˜ìˆ˜ë£Œ</strong>
â€¢ 10ë…„ ë³µìˆ˜ì—¬ê¶Œ: 53,000ì›
â€¢ 5ë…„ ë³µìˆ˜ì—¬ê¶Œ: 45,000ì›
â€¢ ë‹¨ìˆ˜ì—¬ê¶Œ: 20,000ì›

<strong>ì²˜ë¦¬ ê¸°ê°„</strong>
â€¢ ì¼ë°˜: 6-7ì¼
â€¢ ê¸´ê¸‰: 1-3ì¼ (ì¶”ê°€ë¹„ìš©)

<strong>ì˜¨ë¼ì¸ ì‹ ì²­</strong>
â€¢ ì •ë¶€24ì—ì„œ ì‹ ì²­ â†’ ë°©ë¬¸ìˆ˜ë ¹

ğŸ“¸ ì—¬ê¶Œì‚¬ì§„ ê·œì • ì—„ê²©í•˜ë‹ˆ ì£¼ì˜!`;
                    break;
                    
                default:
                    response = `${service}ì— ëŒ€í•´ ìì„¸íˆ ì•Œë ¤ë“œë¦´ê²Œìš”...`;
            }
            
            setTimeout(() => {
                hideTypingIndicator();
                addChatMessage(response, 'bot');
            }, 500);
        }
        
        // ë©”ì¸ ì‘ë‹µ í•¨ìˆ˜ (í•˜ì´ë¸Œë¦¬ë“œ ì²˜ë¦¬)
        async function generateResponse(input) {
            let response = null;
            let context = null;
            
            // 1. ë¯¼ê°ì •ë³´ íƒì§€
            const sensitiveCheck = sensitiveInfoDetector.detect(input);
            sensitiveInfoDetector.logDetection(sensitiveCheck, 'user_input');
            
            // 2. RAG ì‹œìŠ¤í…œìœ¼ë¡œ ê´€ë ¨ ì •ë³´ ê²€ìƒ‰
            if (ragConfig.enabled) {
                context = await searchRAG(input);
            }
            
            // 3. í•˜ì´ë¸Œë¦¬ë“œ ì²˜ë¦¬ ê²°ì •
            if (apiConfig.useHybrid && sensitiveCheck.hasSensitive) {
                // ë¯¼ê°ì •ë³´ í¬í•¨ -> ë¡œì»¬ SLM ì‚¬ìš©
                console.log('[Security] ë¯¼ê°ì •ë³´ íƒì§€. ë¡œì»¬ SLMìœ¼ë¡œ ì²˜ë¦¬.');
                showSecurityNotice('ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•´ ë‚´ë¶€ ì‹œìŠ¤í…œì—ì„œ ì²˜ë¦¬ì¤‘');
                
                response = await callLocalSLM(sensitiveCheck.maskedText, context);
                if (response) {
                    return `ğŸ”’ <strong>[ë³´ì•ˆ ì²˜ë¦¬]</strong><br><br>${response.content}<br><br><small>ê°œì¸ì •ë³´ëŠ” ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤</small>`;
                }
            } else if (apiConfig.useAPI) {
                // ì¼ë°˜ ì§ˆì˜ -> í´ë¼ìš°ë“œ API
                const apiResponse = await callAPI(input, context);
                if (apiResponse) {
                    if (context && (context.laws?.length || context.faqs?.length)) {
                        return apiResponse + `<br><br>ğŸ“š <strong>ì°¸ê³ :</strong><br>` +
                            (context.laws?.map(l => `â€¢ ${l.title}`).join('<br>') || '') +
                            (context.faqs?.map(f => `â€¢ ${f.question}`).join('<br>') || '');
                    }
                    return apiResponse;
                }
            }
            
            // 4. ë¡œì»¬ íŒ¨í„´ ë§¤ì¹­ (í´ë°±)
            const matchedType = patternMatcher.match(input);
            if (matchedType) {
                const localResponse = responseGenerator.generate(matchedType);
                if (context && context.faqs?.length) {
                    return localResponse + `<br><br>ğŸ’¡ <strong>ê´€ë ¨ FAQ:</strong><br>` +
                        context.faqs.slice(0, 2).map(f => `Q: ${f.question}<br>A: ${f.answer}`).join('<br><br>');
                }
                return localResponse;
            }
            
            // 5. ê¸°ë³¸ ì‘ë‹µ
            return responseGenerator.generate('default');
        }

        // ë³´ì•ˆ ì•Œë¦¼ í‘œì‹œ
        function showSecurityNotice(message) {
            const notice = document.createElement('div');
            notice.className = 'security-notice';
            notice.innerHTML = `
                <div style="
                    background: #fff3cd;
                    border: 1px solid #ffc107;
                    border-radius: 8px;
                    padding: 10px;
                    margin: 10px 0;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    animation: fadeIn 0.3s ease;
                ">
                    <span style="font-size: 24px;">ğŸ”’</span>
                    <div>
                        <strong>ë³´ì•ˆ ì•Œë¦¼</strong><br>
                        <small>${message}</small>
                    </div>
                </div>
            `;
            
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                chatMessages.appendChild(notice);
                setTimeout(() => notice.remove(), 3000);
            }
        }

        // ìŒì„±ì¸ì‹
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'ko-KR';
                recognition.continuous = false;
                recognition.interimResults = true;

                recognition.onstart = function() {
                    isListening = true;
                    document.getElementById('micBtn').classList.add('listening');
                };

                recognition.onresult = function(event) {
                    const last = event.results.length - 1;
                    const transcript = event.results[last][0].transcript;
                    
                    if (event.results[last].isFinal) {
                        document.getElementById('chatInput').value = transcript;
                        sendTextMessage();
                    } else {
                        document.getElementById('chatInput').value = transcript;
                    }
                };

                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    stopListening();
                };

                recognition.onend = function() {
                    stopListening();
                };
            }
        }

        function toggleVoiceInput() {
            if (isListening) {
                stopListening();
            } else {
                startListening();
            }
        }

        function startListening() {
            if (recognition) {
                recognition.start();
            }
        }

        function stopListening() {
            isListening = false;
            document.getElementById('micBtn').classList.remove('listening');
            if (recognition) {
                recognition.stop();
            }
        }

        async function sendTextMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            addChatMessage(text, 'user');
            input.value = '';
            
            showTypingIndicator();
            
            const response = await generateResponse(text);
            
            setTimeout(() => {
                hideTypingIndicator();
                addChatMessage(response, 'bot');
            }, 500);
        }

        // ìŒì„± í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        function testVoice() {
            console.log('ìŒì„± í…ŒìŠ¤íŠ¸ ì‹œì‘');
            
            if (!('speechSynthesis' in window)) {
                alert('ë¸Œë¼ìš°ì €ê°€ ìŒì„± ì¶œë ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nChromeì´ë‚˜ Edge ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì´ì „ ìŒì„± ì •ì§€
            window.speechSynthesis.cancel();
            
            const testText = 'ì•ˆë…•í•˜ì„¸ìš”! ìŒì„± í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì´ ì†Œë¦¬ê°€ ë“¤ë¦¬ì‹œë©´ ìŒì„± ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™ì¤‘ì…ë‹ˆë‹¤.';
            const utterance = new SpeechSynthesisUtterance(testText);
            
            utterance.lang = 'ko-KR';
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            
            // ìŒì„± ëª©ë¡ í™•ì¸
            const voices = window.speechSynthesis.getVoices();
            console.log('ì‚¬ìš© ê°€ëŠ¥í•œ ìŒì„±:', voices.length);
            
            // í•œêµ­ì–´ ìŒì„± ì°¾ê¸°
            const koreanVoice = voices.find(voice => 
                voice.lang === 'ko-KR' || 
                voice.lang.includes('ko') || 
                voice.name.includes('Korean')
            );
            
            if (koreanVoice) {
                utterance.voice = koreanVoice;
                console.log('í•œêµ­ì–´ ìŒì„± ì°¾ìŒ:', koreanVoice.name);
            } else {
                console.log('í•œêµ­ì–´ ìŒì„±ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            utterance.onstart = () => console.log('ìŒì„± ì‹œì‘');
            utterance.onend = () => console.log('ìŒì„± ì¢…ë£Œ');
            utterance.onerror = (e) => console.error('ìŒì„± ì˜¤ë¥˜:', e);
            
            try {
                window.speechSynthesis.speak(utterance);
                console.log('ìŒì„± ì¬ìƒ ëª…ë ¹ ì‹¤í–‰ë¨');
            } catch (error) {
                console.error('ìŒì„± ì¬ìƒ ì‹¤íŒ¨:', error);
                alert('ìŒì„± ì¬ìƒ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ìŒì„± ON/OFF í† ê¸€
        function toggleSpeech() {
            isSpeechEnabled = !isSpeechEnabled;
            const speechIcon = document.getElementById('speechIcon');
            const speechText = document.getElementById('speechText');
            
            if (isSpeechEnabled) {
                speechIcon.textContent = 'ğŸ”Š';
                speechText.textContent = 'ìŒì„± ON';
                localStorage.setItem('speechEnabled', 'true');
            } else {
                speechIcon.textContent = 'ğŸ”‡';
                speechText.textContent = 'ìŒì„± OFF';
                localStorage.setItem('speechEnabled', 'false');
                // í˜„ì¬ ì¬ìƒì¤‘ì¸ ìŒì„± ì •ì§€
                window.speechSynthesis.cancel();
            }
        }
        
        // í…ìŠ¤íŠ¸ë¥¼ ìŒì„±ìœ¼ë¡œ ë³€í™˜
        function speakText(text) {
            if (!isSpeechEnabled) {
                console.log('ìŒì„±ì´ êº¼ì ¸ìˆìŒ');
                return;
            }
            
            if (!('speechSynthesis' in window)) {
                console.log('ë¸Œë¼ìš°ì €ê°€ ìŒì„±ì„ ì§€ì›í•˜ì§€ ì•ŠìŒ');
                return;
            }
            
            console.log('ìŒì„± ì¶œë ¥ ì‹œì‘');
            
            // ì´ì „ ìŒì„± ì •ì§€
            window.speechSynthesis.cancel();
            
            // HTML íƒœê·¸ ì œê±° ë° í…ìŠ¤íŠ¸ ì •ë¦¬
            const cleanText = text
                .replace(/<[^>]*>/g, '') // HTML íƒœê·¸ ì œê±°
                .replace(/[â€¢Â·]/g, '') // ë¶ˆë¦¿ í¬ì¸íŠ¸ ì œê±°
                .replace(/\n{3,}/g, '\n\n') // ê³¼ë„í•œ ì¤„ë°”ê¿ˆ ì œê±°
                .replace(/[ğŸ˜ŠğŸ“ğŸ’¡ğŸ‘¶âœˆï¸ğŸ ğŸ¥ğŸ’¼ğŸ’ªğŸ“ŒğŸ”ğŸ’°ğŸ«ğŸ“‹ğŸ“„ğŸ¤–ğŸ‘¤âš™ï¸ğŸ”ŠğŸ”‡]/g, '') // ì´ëª¨ì§€ ì œê±°
                .replace(/[1ï¸âƒ£2ï¸âƒ£3ï¸âƒ£4ï¸âƒ£]/g, '') // ìˆ«ì ì´ëª¨ì§€ ì œê±°
                .trim();
            
            // í…ìŠ¤íŠ¸ë¥¼ ì‘ì€ ì²­í¬ë¡œ ë‚˜ëˆ„ê¸° (ë„ˆë¬´ ê¸´ í…ìŠ¤íŠ¸ ë°©ì§€)
            const maxLength = 200;
            const chunks = [];
            let currentChunk = '';
            
            const sentences = cleanText.split(/[.!?]\s/);
            for (const sentence of sentences) {
                if ((currentChunk + sentence).length < maxLength) {
                    currentChunk += sentence + '. ';
                } else {
                    if (currentChunk) chunks.push(currentChunk);
                    currentChunk = sentence + '. ';
                }
            }
            if (currentChunk) chunks.push(currentChunk);
            
            // ì²« ë²ˆì§¸ ì²­í¬ë§Œ ì¬ìƒ (ì „ì²´ í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ê¸¸ë©´ ì²˜ìŒ ë¶€ë¶„ë§Œ)
            const textToSpeak = chunks[0] || cleanText.substring(0, 200);
            
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = 'ko-KR';
            utterance.rate = 0.9; // ì†ë„ ì¡°ì ˆ
            utterance.pitch = 1.0; // ìŒë†’ì´
            utterance.volume = 1.0; // ë³¼ë¥¨
            
            // í•œêµ­ì–´ ìŒì„± ì°¾ê¸°
            const voices = window.speechSynthesis.getVoices();
            const koreanVoice = voices.find(voice => 
                voice.lang === 'ko-KR' || 
                voice.lang.includes('ko') ||
                voice.name.includes('Korean') ||
                voice.name.includes('í•œêµ­')
            );
            
            if (koreanVoice) {
                utterance.voice = koreanVoice;
                console.log('í•œêµ­ì–´ ìŒì„± ì‚¬ìš©:', koreanVoice.name);
            } else {
                console.log('í•œêµ­ì–´ ìŒì„±ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ ê¸°ë³¸ ìŒì„± ì‚¬ìš©');
            }
            
            utterance.onstart = () => console.log('ìŒì„± ì¬ìƒ ì‹œì‘');
            utterance.onend = () => console.log('ìŒì„± ì¬ìƒ ì™„ë£Œ');
            utterance.onerror = (e) => console.error('ìŒì„± ì¬ìƒ ì˜¤ë¥˜:', e);
            
            try {
                window.speechSynthesis.speak(utterance);
            } catch (error) {
                console.error('ìŒì„± ì¬ìƒ ì‹¤íŒ¨:', error);
            }
        }
        
        function addChatMessage(text, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const time = new Date().toLocaleTimeString('ko-KR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            // í…ìŠ¤íŠ¸ í¬ë§·íŒ… ê°œì„ 
            let formattedText = text;
            if (sender === 'bot') {
                // ì¤„ë°”ê¿ˆ ì²˜ë¦¬ë¥¼ ê°œì„ 
                formattedText = text
                    .replace(/\n\n/g, '<br><br>')
                    .replace(/\n/g, '<br>')
                    .replace(/(<br>)+/g, '<br><br>'); // ê³¼ë„í•œ ì¤„ë°”ê¿ˆ ì •ë¦¬
            }
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${sender === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–'}</div>
                <div class="message-content">
                    <div class="message-text">${formattedText}</div>
                    <div class="message-time">${time}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // ë´‡ ë©”ì‹œì§€ì¸ ê²½ìš° ìŒì„±ìœ¼ë¡œ ì½ê¸°
            if (sender === 'bot') {
                speakText(text);
            }
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').classList.add('active');
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').classList.remove('active');
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendTextMessage();
            }
        }

        // ë‹¨ê³„ë³„ í‚¤ì˜¤ìŠ¤í¬ ì‹œìŠ¤í…œ
        let currentStep = 1;
        let userProfile = {
            age: null,
            ageDetail: null,
            situation: null,
            conditions: {},
            selectedService: null
        };
        
        // í‚¤ì˜¤ìŠ¤í¬ ì‚¬ì´ë“œë°” í† ê¸€
        function toggleSidebar() {
            const sidebar = document.getElementById('kioskSidebar');
            const toggleIcon = document.getElementById('toggleIcon');
            
            if (sidebar.classList.contains('collapsed')) {
                sidebar.classList.remove('collapsed');
                toggleIcon.textContent = 'â—€';
            } else {
                sidebar.classList.add('collapsed');
                toggleIcon.textContent = 'â–¶';
            }
        }
        
        // STEP 1: ë‚˜ì´ ì„ íƒ
        function selectAgeStep(age) {
            userProfile.age = age;
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('[data-age]').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`[data-age="${age}"]`).classList.add('selected');
            
            // ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™”
            document.getElementById('nextBtn').disabled = false;
            
            // ë‚˜ì´ë³„ ë§ì¶¤ ìƒí™© ì¤€ë¹„
            prepareSituationOptions(age);
        }
        
        // STEP 2: ìƒí™© ì˜µì…˜ ì¤€ë¹„
        function prepareSituationOptions(age) {
            const container = document.getElementById('situationOptions');
            let html = '<div class="situation-grid">';
            
            // ë‚˜ì´ë³„ ë§ì¶¤ ìƒí™© ì œê³µ
            if (age === 'senior' || age === 'senior-plus' || age === 'early-senior') {
                html += `
                    <button class="situation-btn" onclick="selectSituationStep('pension')" data-situation="pension">
                        ğŸ’° ì—°ê¸ˆ/ìˆ˜ë‹¹
                    </button>
                    <button class="situation-btn" onclick="selectSituationStep('senior-job')" data-situation="senior-job">
                        ğŸ’¼ ë…¸ì¸ì¼ìë¦¬
                    </button>
                    <button class="situation-btn" onclick="selectSituationStep('medical')" data-situation="medical">
                        ğŸ¥ ì˜ë£Œ/ê±´ê°•
                    </button>
                    <button class="situation-btn" onclick="selectSituationStep('welfare')" data-situation="welfare">
                        ğŸ¤ ëŒë´„ì„œë¹„ìŠ¤
                    </button>`;
            } else if (age === 'young') {
                html += `
                    <button class="situation-btn" onclick="selectSituationStep('job')" data-situation="job">
                        ğŸ’¼ ì·¨ì—…/ì°½ì—…
                    </button>
                    <button class="situation-btn" onclick="selectSituationStep('housing-young')" data-situation="housing-young">
                        ğŸ  ì²­ë…„ì£¼ê±°
                    </button>
                    <button class="situation-btn" onclick="selectSituationStep('education')" data-situation="education">
                        ğŸ“ êµìœ¡/í›ˆë ¨
                    </button>
                    <button class="situation-btn" onclick="selectSituationStep('loan')" data-situation="loan">
                        ğŸ’³ ì²­ë…„ëŒ€ì¶œ
                    </button>`;
            } else if (age === 'youth') {
                html += `
                    <button class="situation-btn" onclick="selectSituationStep('education-support')" data-situation="education-support">
                        ğŸ“š êµìœ¡ì§€ì›
                    </button>
                    <button class="situation-btn" onclick="selectSituationStep('child-welfare')" data-situation="child-welfare">
                        ğŸ‘¶ ì•„ë™ë³µì§€
                    </button>
                    <button class="situation-btn" onclick="selectSituationStep('family')" data-situation="family">
                        ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ê°€ì¡±ì§€ì›
                    </button>`;
            }
            
            // ê³µí†µ ì˜µì…˜
            html += `
                <button class="situation-btn" onclick="selectSituationStep('emergency')" data-situation="emergency">
                    ğŸš¨ ê¸´ê¸‰ì§€ì›
                </button>
                <button class="situation-btn" onclick="selectSituationStep('housing')" data-situation="housing">
                    ğŸ  ì£¼ê±°ë¬¸ì œ
                </button>
                <button class="situation-btn" onclick="selectSituationStep('financial')" data-situation="financial">
                    ğŸ’µ ìƒí™œë¹„ì§€ì›
                </button>`;
            
            // ëª¨ë“  ì—°ë ¹ëŒ€ì— ê¸°íƒ€ ì˜µì…˜ ì¶”ê°€
            html += `
                <button class="situation-btn" onclick="showCustomSituationInput()" data-situation="other">
                    âœï¸ ê¸°íƒ€<br>(ì§ì ‘ ì…ë ¥)
                </button>`;
            
            html += '</div>';
            
            // ì‚¬ìš©ì ì •ì˜ ì…ë ¥ ì˜ì—­ ì¶”ê°€
            html += `
                <div id="customSituationInput" style="display: none; margin-top: 15px;">
                    <input type="text" id="customSituation" placeholder="ìƒí™©ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì´ì‚¬, ì¶œì‚°, ì°½ì—… ë“±)" 
                           style="padding: 10px; width: 100%; border: 1px solid #ddd; border-radius: 5px;">
                    <button onclick="submitCustomSituation()" 
                            style="margin-top: 10px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;">
                        í™•ì¸
                    </button>
                </div>`;
            
            container.innerHTML = html;
        }
        
        // STEP 2: ìƒí™© ì„ íƒ
        function selectSituationStep(situation) {
            userProfile.situation = situation;
            
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('[data-situation]').forEach(btn => {
                btn.classList.remove('selected');
            });
            const selectedBtn = document.querySelector(`[data-situation="${situation}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected');
            }
            
            // ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™”
            document.getElementById('nextBtn').disabled = false;
            
            console.log('ìƒí™© ì„ íƒ:', situation);
        }
        
        // STEP 3: ì„¸ë¶€ ì¡°ê±´ ì¤€ë¹„
        function prepareDetailConditions(age, situation) {
            const container = document.getElementById('detailConditions');
            if (!container) {
                console.error('detailConditions ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            let html = '<div class="detail-options">';
            
            // ëª¨ë“  ìƒí™©ì— ëŒ€í•œ ì„¸ë¶€ ì¡°ê±´ ì²˜ë¦¬
            if (situation === 'pension' || situation === 'senior-job' || situation === 'welfare') {
                // ë…¸ì¸ ê´€ë ¨ ì„œë¹„ìŠ¤
                html += `
                    <h4>ğŸ’° ì†Œë“ ìˆ˜ì¤€</h4>
                    <label class="detail-option">
                        <input type="radio" name="income" value="low" onchange="updateCondition('income', 'low')">
                        ì†Œë“í•˜ìœ„ 70% (ê¸°ì´ˆì—°ê¸ˆ ëŒ€ìƒ)
                    </label>
                    <label class="detail-option">
                        <input type="radio" name="income" value="very-low" onchange="updateCondition('income', 'very-low')">
                        ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì
                    </label>
                    <label class="detail-option">
                        <input type="radio" name="income" value="middle" onchange="updateCondition('income', 'middle')">
                        ì¤‘ìœ„ì†Œë“ ì´ìƒ
                    </label>
                    
                    <h4 style="margin-top:15px;">ğŸ  ê°€êµ¬ í˜•íƒœ</h4>
                    <label class="detail-option">
                        <input type="checkbox" onchange="updateCondition('alone', this.checked)">
                        ë…ê±°ë…¸ì¸
                    </label>
                    <label class="detail-option">
                        <input type="checkbox" onchange="updateCondition('disabled', this.checked)">
                        ì¥ì• ê°€ ìˆìŒ
                    </label>
                    <label class="detail-option">
                        <input type="checkbox" onchange="updateCondition('dementia', this.checked)">
                        ì¹˜ë§¤ ì˜ì‹¬
                    </label>`;
            } else if (situation === 'job' || situation === 'housing-young' || situation === 'education' || situation === 'loan') {
                // ì²­ë…„ ê´€ë ¨ ì„œë¹„ìŠ¤
                html += `
                    <h4>ğŸ‘¥ ì·¨ì—… ìƒíƒœ</h4>
                    <label class="detail-option">
                        <input type="radio" name="job-status" value="unemployed" onchange="updateCondition('jobStatus', 'unemployed')">
                        êµ¬ì§ì¤‘ (ë¯¸ì·¨ì—…)
                    </label>
                    <label class="detail-option">
                        <input type="radio" name="job-status" value="graduate" onchange="updateCondition('jobStatus', 'graduate')">
                        ì¡¸ì—…ì˜ˆì •ì
                    </label>
                    <label class="detail-option">
                        <input type="radio" name="job-status" value="employed" onchange="updateCondition('jobStatus', 'employed')">
                        ì¬ì§ì¤‘
                    </label>
                    
                    <h4 style="margin-top:15px;">ğŸ’µ ì†Œë“ ìˆ˜ì¤€</h4>
                    <label class="detail-option">
                        <input type="checkbox" onchange="updateCondition('low-income', this.checked)">
                        ì¤‘ìœ„ì†Œë“ 150% ì´í•˜
                    </label>
                    <label class="detail-option">
                        <input type="checkbox" onchange="updateCondition('first-job', this.checked)">
                        ì²« ì·¨ì—… ì¤€ë¹„
                    </label>`;
            } else if (situation === 'medical') {
                // ì˜ë£Œ ê´€ë ¨
                html += `
                    <h4>ğŸ¥ ì˜ë£Œë¹„ ë¶€ë‹´</h4>
                    <label class="detail-option">
                        <input type="radio" name="medical" value="chronic" onchange="updateCondition('medical', 'chronic')">
                        ë§Œì„±ì§ˆí™˜ ì¹˜ë£Œì¤‘
                    </label>
                    <label class="detail-option">
                        <input type="radio" name="medical" value="surgery" onchange="updateCondition('medical', 'surgery')">
                        ìˆ˜ìˆ /ì…ì› í•„ìš”
                    </label>
                    <label class="detail-option">
                        <input type="radio" name="medical" value="rare" onchange="updateCondition('medical', 'rare')">
                        í¬ê·€ë‚œì¹˜ì„± ì§ˆí™˜
                    </label>
                    
                    <h4 style="margin-top:15px;">ğŸ” ì¶”ê°€ ìƒí™©</h4>
                    <label class="detail-option">
                        <input type="checkbox" onchange="updateCondition('insurance', this.checked)">
                        ê±´ê°•ë³´í—˜ ì²´ë‚©
                    </label>`;
            } else if (situation === 'housing' || situation === 'emergency' || situation === 'financial') {
                // ê¸´ê¸‰/ì£¼ê±°/ìƒí™œ ì§€ì›
                html += `
                    <h4>ğŸ  ì£¼ê±° ìƒí™©</h4>
                    <label class="detail-option">
                        <input type="radio" name="housing" value="rent" onchange="updateCondition('housing', 'rent')">
                        ì›”ì„¸/ì „ì„¸ ê±°ì£¼
                    </label>
                    <label class="detail-option">
                        <input type="radio" name="housing" value="own" onchange="updateCondition('housing', 'own')">
                        ìê°€ ê±°ì£¼
                    </label>
                    <label class="detail-option">
                        <input type="radio" name="housing" value="homeless" onchange="updateCondition('housing', 'homeless')">
                        ì£¼ê±° ë¶ˆì•ˆì •
                    </label>
                    
                    <h4 style="margin-top:15px;">ğŸ†˜ ê¸´ê¸‰ ìƒí™©</h4>
                    <label class="detail-option">
                        <input type="checkbox" onchange="updateCondition('emergency-medical', this.checked)">
                        ê°‘ì‘ìŠ¤ëŸ° ì§ˆë³‘/ì‚¬ê³ 
                    </label>
                    <label class="detail-option">
                        <input type="checkbox" onchange="updateCondition('emergency-income', this.checked)">
                        ì†Œë“ ìƒì‹¤
                    </label>
                    <label class="detail-option">
                        <input type="checkbox" onchange="updateCondition('emergency-disaster', this.checked)">
                        í™”ì¬/ìì—°ì¬í•´
                    </label>`;
            } else {
                // ê¸°íƒ€ ëª¨ë“  ìƒí™©ì— ëŒ€í•œ ê¸°ë³¸ ì„ íƒ
                html += `
                    <h4>ğŸ’° ê°€êµ¬ ì†Œë“</h4>
                    <label class="detail-option">
                        <input type="radio" name="income" value="low" onchange="updateCondition('income', 'low')">
                        ì €ì†Œë“ì¸µ (ì¤‘ìœ„ì†Œë“ 50% ì´í•˜)
                    </label>
                    <label class="detail-option">
                        <input type="radio" name="income" value="middle" onchange="updateCondition('income', 'middle')">
                        ì¤‘ì†Œë“ì¸µ
                    </label>
                    <label class="detail-option">
                        <input type="radio" name="income" value="high" onchange="updateCondition('income', 'high')">
                        ì¼ë°˜ ì†Œë“
                    </label>
                    
                    <h4 style="margin-top:15px;">ğŸ  ê°€êµ¬ í˜•íƒœ</h4>
                    <label class="detail-option">
                        <input type="checkbox" onchange="updateCondition('single', this.checked)">
                        1ì¸ ê°€êµ¬
                    </label>
                    <label class="detail-option">
                        <input type="checkbox" onchange="updateCondition('children', this.checked)">
                        ë¯¸ì„±ë…„ ìë…€ ìˆìŒ
                    </label>
                    <label class="detail-option">
                        <input type="checkbox" onchange="updateCondition('disabled-family', this.checked)">
                        ì¥ì• ì¸ ê°€ì¡± ìˆìŒ
                    </label>`;
            }
            
            html += `
                <div style="margin-top: 20px; padding: 10px; background: #e3f2fd; border-radius: 8px;">
                    <small>ğŸ’¡ í•´ë‹¹í•˜ëŠ” ì¡°ê±´ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”</small>
                </div>
                
                <h4 style="margin-top:15px;">âœï¸ ê¸°íƒ€ ì¡°ê±´</h4>
                <label class="detail-option">
                    <input type="checkbox" onchange="showCustomConditionInput()">
                    ê¸°íƒ€ (ì§ì ‘ ì…ë ¥)
                </label>
                <div id="customConditionInput" style="display: none; margin-top: 10px;">
                    <textarea id="customCondition" placeholder="ì¶”ê°€ ì¡°ê±´ì´ë‚˜ íŠ¹ë³„í•œ ìƒí™©ì„ ì…ë ¥í•˜ì„¸ìš”" 
                              style="width: 100%; padding: 8px; height: 60px; border: 1px solid #ddd; border-radius: 5px;"></textarea>
                    <button onclick="submitCustomCondition()" 
                            style="margin-top: 5px; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        ì¶”ê°€
                    </button>
                </div>
            </div>`;
            
            container.innerHTML = html;
            
            // ë‹¤ìŒ ë²„íŠ¼ ë¹„í™œì„±í™” (ì¡°ê±´ ì„ íƒ ì „ê¹Œì§€)
            document.getElementById('nextBtn').disabled = true;
            
            console.log('ì„¸ë¶€ ì¡°ê±´ ì¤€ë¹„ ì™„ë£Œ:', age, situation);
        }
        
        // ì¡°ê±´ ì—…ë°ì´íŠ¸
        function updateCondition(key, value) {
            userProfile.conditions[key] = value;
            
            // ìµœì†Œ í•˜ë‚˜ì˜ ì¡°ê±´ì´ ì„ íƒë˜ì–´ì•¼ ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™”
            const hasConditions = Object.keys(userProfile.conditions).length > 0;
            document.getElementById('nextBtn').disabled = !hasConditions;
            
            console.log('ì¡°ê±´ ì—…ë°ì´íŠ¸:', userProfile.conditions);
        }
        
        // ë‹¤ìŒ ë‹¨ê³„
        function nextStep() {
            // í˜„ì¬ ë‹¨ê³„ì—ì„œ ì„ íƒí•œ ê°’ í™•ì¸
            if (currentStep === 1 && !userProfile.age) {
                alert('ì—°ë ¹ëŒ€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            if (currentStep === 2 && !userProfile.situation) {
                alert('í•„ìš”í•œ ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            if (currentStep === 3 && Object.keys(userProfile.conditions).length === 0) {
                alert('ì„¸ë¶€ ì¡°ê±´ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (currentStep < 4) {
                // í˜„ì¬ ë‹¨ê³„ ìˆ¨ê¸°ê¸°
                document.getElementById(`step${currentStep}`).classList.remove('active');
                document.getElementById(`step${currentStep}Dot`).classList.remove('active');
                document.getElementById(`step${currentStep}Dot`).classList.add('completed');
                
                // ë‹¤ìŒ ë‹¨ê³„ í‘œì‹œ
                currentStep++;
                document.getElementById(`step${currentStep}`).classList.add('active');
                document.getElementById(`step${currentStep}Dot`).classList.add('active');
                
                // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                document.getElementById('backBtn').disabled = false;
                
                // Step 3ë¡œ ì´ë™ ì‹œ ì„¸ë¶€ ì¡°ê±´ ì¤€ë¹„
                if (currentStep === 3) {
                    prepareDetailConditions(userProfile.age, userProfile.situation);
                    document.getElementById('nextBtn').disabled = true; // ì¡°ê±´ ì„ íƒ ì „ê¹Œì§€ ë¹„í™œì„±í™”
                }
                
                if (currentStep === 4) {
                    document.getElementById('nextBtn').textContent = 'ì‹ ì²­ ì‹œì‘í•˜ê¸°';
                    generateFinalRecommendations();
                } else if (currentStep === 2 || currentStep === 3) {
                    // ë‹¨ê³„ 2,3ì—ì„œëŠ” ìƒˆë¡œìš´ ì„ íƒì´ í•„ìš”í•˜ë¯€ë¡œ ë‹¤ìŒ ë²„íŠ¼ ë¹„í™œì„±í™”
                    document.getElementById('nextBtn').disabled = true;
                }
                
                console.log('í˜„ì¬ ë‹¨ê³„:', currentStep, 'ì‚¬ìš©ì í”„ë¡œí•„:', userProfile);
            } else {
                // ì‹ ì²­ í”„ë¡œì„¸ìŠ¤ ì‹œì‘
                startApplicationProcess();
            }
        }
        
        // ì´ì „ ë‹¨ê³„
        function previousStep() {
            if (currentStep > 1) {
                // í˜„ì¬ ë‹¨ê³„ ìˆ¨ê¸°ê¸°
                document.getElementById(`step${currentStep}`).classList.remove('active');
                document.getElementById(`step${currentStep}Dot`).classList.remove('active');
                
                // ì´ì „ ë‹¨ê³„ í‘œì‹œ
                currentStep--;
                document.getElementById(`step${currentStep}`).classList.add('active');
                document.getElementById(`step${currentStep}Dot`).classList.add('active');
                document.getElementById(`step${currentStep}Dot`).classList.remove('completed');
                
                // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                if (currentStep === 1) {
                    document.getElementById('backBtn').disabled = true;
                }
                
                document.getElementById('nextBtn').textContent = 'ë‹¤ìŒ ë‹¨ê³„ â†’';
                
                // ì´ì „ì— ì„ íƒí•œ ê°’ì´ ìˆìœ¼ë©´ ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™”
                if (currentStep === 1 && userProfile.age) {
                    document.getElementById('nextBtn').disabled = false;
                } else if (currentStep === 2 && userProfile.situation) {
                    document.getElementById('nextBtn').disabled = false;
                } else if (currentStep === 3 && Object.keys(userProfile.conditions).length > 0) {
                    document.getElementById('nextBtn').disabled = false;
                } else {
                    document.getElementById('nextBtn').disabled = true;
                }
                
                console.log('í˜„ì¬ ë‹¨ê³„:', currentStep);
            }
        }
        
        // ìµœì¢… ì¶”ì²œ ìƒì„±
        function generateFinalRecommendations() {
            const container = document.getElementById('finalRecommendations');
            let html = '<div style="padding: 15px; background: #e8f5e9; border-radius: 10px; margin-bottom: 15px;">';
            
            // í”„ë¡œí•„ ìš”ì•½
            html += '<h4>ğŸ“‹ ì„ íƒí•˜ì‹  ì¡°ê±´</h4>';
            html += `<p>â€¢ ì—°ë ¹: ${getAgeLabel(userProfile.age)}</p>`;
            html += `<p>â€¢ ìƒí™©: ${getSituationLabel(userProfile.situation)}</p>`;
            
            if (Object.keys(userProfile.conditions).length > 0) {
                html += '<p>â€¢ ì„¸ë¶€ì¡°ê±´: ';
                for (let key in userProfile.conditions) {
                    if (userProfile.conditions[key]) {
                        html += `${getConditionLabel(key, userProfile.conditions[key])}, `;
                    }
                }
                html = html.slice(0, -2) + '</p>';
            }
            html += '</div>';
            
            // ë§ì¶¤ ì„œë¹„ìŠ¤ ì¶”ì²œ
            html += '<h4>âœ¨ ì¶”ì²œ ì„œë¹„ìŠ¤</h4>';
            const services = getPersonalizedServices(userProfile);
            
            services.forEach(service => {
                html += `
                    <div style="padding: 12px; background: white; border: 2px solid #4CAF50; border-radius: 8px; margin: 10px 0;">
                        <h5 style="color: #4CAF50; margin: 0 0 8px 0;">${service.icon} ${service.name}</h5>
                        <p style="margin: 5px 0; font-size: 0.9em;">${service.description}</p>
                        <p style="margin: 5px 0; font-size: 0.85em; color: #666;">â€¢ ì§€ì›ê¸ˆì•¡: ${service.amount}</p>
                        <p style="margin: 5px 0; font-size: 0.85em; color: #666;">â€¢ ì‹ ì²­ìê²©: ${service.eligibility}</p>
                        <button onclick="startServiceApplication('${service.id}')" 
                                style="margin-top: 8px; padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ“ ì‹ ì²­ ë„ìš°ë¯¸ ì‹œì‘
                        </button>
                    </div>`;
            });
            
            container.innerHTML = html;
        }
        
        // ê°œì¸í™”ëœ ì„œë¹„ìŠ¤ ì¶”ì²œ
        function getPersonalizedServices(profile) {
            let services = [];
            
            console.log('ì„œë¹„ìŠ¤ ì¶”ì²œ ì‹œì‘:', profile);
            
            // ëª¨ë“  ì—°ë ¹ëŒ€ì™€ ìƒí™©ì— ëŒ€í•œ ì„œë¹„ìŠ¤ ì¶”ì²œ
            
            // ë…¸ì¸ ê´€ë ¨ ì„œë¹„ìŠ¤
            if (profile.age === 'senior' || profile.age === 'senior-plus' || profile.age === 'early-senior') {
                // ê¸°ì´ˆì—°ê¸ˆ - ëŒ€ë¶€ë¶„ì˜ ë…¸ì¸ì—ê²Œ í•´ë‹¹
                if (!profile.conditions || !profile.conditions.income || 
                    profile.conditions.income === 'low' || profile.conditions.income === 'very-low') {
                    services.push({
                        id: 'basic-pension',
                        name: 'ê¸°ì´ˆì—°ê¸ˆ',
                        icon: 'ğŸ’°',
                        description: 'ì†Œë“ í•˜ìœ„ 70% ì–´ë¥´ì‹ ê»˜ ë§¤ë‹¬ ì§€ê¸‰ë˜ëŠ” ì—°ê¸ˆ',
                        amount: 'ì›” ìµœëŒ€ 334,810ì›',
                        eligibility: 'ë§Œ 65ì„¸ ì´ìƒ, ì†Œë“ì¸ì •ì•¡ ê¸°ì¤€ ì¶©ì¡±'
                    });
                }
                
                if (profile.conditions.income === 'very-low') {
                    services.push({
                        id: 'basic-living',
                        name: 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰',
                        icon: 'ğŸ ',
                        description: 'ìƒê³„, ì˜ë£Œ, ì£¼ê±°, êµìœ¡ ê¸‰ì—¬ ì§€ì›',
                        amount: 'ìƒê³„ê¸‰ì—¬ ì›” ìµœëŒ€ 62ë§Œì› + ì˜ë£Œ/ì£¼ê±° ì§€ì›',
                        eligibility: 'ì¤‘ìœ„ì†Œë“ 30~50% ì´í•˜'
                    });
                }
                
                if (profile.conditions.alone) {
                    services.push({
                        id: 'alone-senior',
                        name: 'ë…ê±°ë…¸ì¸ ì§€ì›',
                        icon: 'ğŸ¤',
                        description: 'ë…ê±°ë…¸ì¸ì„ ìœ„í•œ ëŒë´„ ì„œë¹„ìŠ¤',
                        amount: 'ì•ˆë¶€í™•ì¸, ìƒí™œì§€ì› ì„œë¹„ìŠ¤',
                        eligibility: 'ë§Œ 65ì„¸ ì´ìƒ ë…ê±°ë…¸ì¸'
                    });
                }
            }
            
            // ì²­ë…„ ê´€ë ¨ ì„œë¹„ìŠ¤
            else if (profile.age === 'young') {
                // ì·¨ì—… ì§€ì›
                if (profile.situation === 'job' || !profile.situation || 
                    !profile.conditions || profile.conditions.jobStatus === 'unemployed') {
                    services.push({
                        id: 'job-support',
                        name: 'êµ­ë¯¼ì·¨ì—…ì§€ì›ì œë„',
                        icon: 'ğŸ’¼',
                        description: 'êµ¬ì§ì´‰ì§„ìˆ˜ë‹¹ê³¼ ì·¨ì—…ì§€ì› ì„œë¹„ìŠ¤',
                        amount: 'ì›” 50ë§Œì› Ã— 6ê°œì›” + ì·¨ì—…ì§€ì›',
                        eligibility: 'ë§Œ 15~69ì„¸ êµ¬ì§ì'
                    });
                }
                
                if (profile.conditions.training) {
                    services.push({
                        id: 'training',
                        name: 'êµ­ë¯¼ë‚´ì¼ë°°ì›€ì¹´ë“œ',
                        icon: 'ğŸ“',
                        description: 'ì§ì—…í›ˆë ¨ë¹„ ì§€ì›',
                        amount: 'ì—° 300~500ë§Œì›',
                        eligibility: 'êµ¬ì§ì, ì¬ì§ì ë“±'
                    });
                }
            }
            
            // ê³µí†µ ì„œë¹„ìŠ¤ - ëª¨ë“  ì—°ë ¹ëŒ€
            
            // ì˜ë£Œ ì§€ì›
            if (profile.situation === 'medical') {
                services.push({
                    id: 'medical-support',
                    name: 'ì˜ë£Œê¸‰ì—¬',
                    icon: 'ğŸ¥',
                    description: 'ì˜ë£Œë¹„ ë¶€ë‹´ ê²½ê°',
                    amount: 'ë³¸ì¸ë¶€ë‹´ê¸ˆ ëŒ€í­ ê²½ê°',
                    eligibility: 'ì¤‘ìœ„ì†Œë“ 40% ì´í•˜'
                });
            }
            
            // ê¸´ê¸‰ ì§€ì›
            if (profile.situation === 'emergency') {
                services.push({
                    id: 'emergency-support',
                    name: 'ê¸´ê¸‰ë³µì§€ì§€ì›',
                    icon: 'ğŸ†˜',
                    description: 'ê°‘ì‘ìŠ¤ëŸ° ìœ„ê¸°ìƒí™© ì§€ì›',
                    amount: 'ìƒê³„ë¹„ ì›” 162ë§Œì›(ìµœëŒ€ 6ê°œì›”)',
                    eligibility: 'ìœ„ê¸°ìƒí™© ê°€êµ¬'
                });
            }
            
            // ì£¼ê±° ì§€ì›
            if (profile.situation === 'housing' || profile.situation === 'housing-young') {
                services.push({
                    id: 'housing-support',
                    name: 'ì£¼ê±°ê¸‰ì—¬',
                    icon: 'ğŸ¡',
                    description: 'ì„ì°¨ë£Œ ë˜ëŠ” ìˆ˜ì„ ìœ ì§€ë¹„ ì§€ì›',
                    amount: 'ì§€ì—­/ê°€êµ¬ìˆ˜ë³„ ì°¨ë“±',
                    eligibility: 'ì¤‘ìœ„ì†Œë“ 48% ì´í•˜'
                });
            }
            
            // ê¸°ë³¸ ì¶”ì²œ (ì„œë¹„ìŠ¤ê°€ ì—†ì„ ê²½ìš°)
            if (services.length === 0) {
                services.push({
                    id: 'consult',
                    name: 'ë§ì¶¤ ìƒë‹´ í•„ìš”',
                    icon: 'ğŸ’¬',
                    description: 'ì£¼ë¯¼ì„¼í„°ì—ì„œ ìì„¸í•œ ìƒë‹´ì„ ë°›ì•„ë³´ì„¸ìš”',
                    amount: 'ìƒë‹´ í›„ ê²°ì •',
                    eligibility: 'ëª¨ë“  êµ­ë¯¼'
                });
            }
            
            // í•­ìƒ ë§ˆì§€ë§‰ì— ê¸°íƒ€ ì˜µì…˜ ì¶”ê°€
            services.push({
                id: 'other',
                name: 'ê¸°íƒ€ ì„œë¹„ìŠ¤ (ì§ì ‘ ì…ë ¥)',
                icon: 'âœï¸',
                description: 'ìœ„ ëª©ë¡ì— ì—†ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì§ì ‘ ì…ë ¥í•˜ì—¬ ì‹ ì²­í•˜ì„¸ìš”',
                amount: 'ì„œë¹„ìŠ¤ë³„ ìƒì´',
                eligibility: 'ì„œë¹„ìŠ¤ë³„ ìƒì´'
            });
            
            console.log('ì¶”ì²œ ì„œë¹„ìŠ¤:', services);
            return services;
        }
        
        // ì„œë¹„ìŠ¤ ì‹ ì²­ í”„ë¡œì„¸ìŠ¤ ì‹œì‘
        function startServiceApplication(serviceId) {
            userProfile.selectedService = serviceId;
            
            // ì±„íŒ…ì°½ì— ë‹¨ê³„ë³„ ì•ˆë‚´ ì‹œì‘
            const message = `${serviceId} ì‹ ì²­ì„ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ë‹¨ê³„ë³„ë¡œ ì•ˆë‚´í•´ë“œë¦´ê²Œìš”!`;
            addChatMessage(message, 'bot');
            
            // ì‹ ì²­ ë‹¨ê³„ë³„ ì•ˆë‚´
            setTimeout(() => {
                startStepByStepGuidance(serviceId);
            }, 1000);
        }
        
        // í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ê°€ì´ë“œ ì •ë³´ ì €ì¥
        let currentGuidance = {
            steps: [],
            currentIndex: 0,
            serviceId: null
        };

        // ë‹¨ê³„ë³„ ì‹ ì²­ ì•ˆë‚´
        function startStepByStepGuidance(serviceId) {
            let guidanceSteps = [];
            
            if (serviceId === 'basic-pension') {
                guidanceSteps = [
                    {
                        title: "ğŸ“ STEP 1: ì‹ ì²­ ì¥ì†Œ í™•ì¸",
                        content: `ê°€ê¹Œìš´ ì£¼ë¯¼ì„¼í„°ë¥¼ ì°¾ì•„ë“œë¦´ê²Œìš”.
ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬)`,
                        action: "location"
                    },
                    {
                        title: "ğŸ“‹ STEP 2: í•„ìš” ì„œë¥˜ ì¤€ë¹„",
                        content: `ë‹¤ìŒ ì„œë¥˜ë¥¼ ì¤€ë¹„í•´ì£¼ì„¸ìš”:
âœ… ì‹ ë¶„ì¦ (ì£¼ë¯¼ë“±ë¡ì¦ ë˜ëŠ” ìš´ì „ë©´í—ˆì¦)
âœ… í†µì¥ì‚¬ë³¸
âœ… ì†Œë“Â·ì¬ì‚° ì‹ ê³ ì„œ (ì£¼ë¯¼ì„¼í„°ì— ë¹„ì¹˜)
âœ… ì „ì›”ì„¸ ê³„ì•½ì„œ (í•´ë‹¹ìë§Œ)`,
                        action: "checklist"
                    },
                    {
                        title: "ğŸ“ STEP 3: ì‹ ì²­ì„œ ì‘ì„± ë„ìš°ë¯¸",
                        content: `ì‹ ì²­ì„œ ì‘ì„±ì„ ë„ì™€ë“œë¦´ê²Œìš”.
ê¸°ë³¸ì •ë³´ë¶€í„° ì…ë ¥í•´ë³¼ê¹Œìš”?`,
                        action: "form"
                    },
                    {
                        title: "ğŸ¢ STEP 4: ë°©ë¬¸ ì˜ˆì•½",
                        content: `ì£¼ë¯¼ì„¼í„° ë°©ë¬¸ ì˜ˆì•½ì„ ë„ì™€ë“œë¦´ê²Œìš”.
í¬ë§ ë‚ ì§œì™€ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.`,
                        action: "booking"
                    },
                    {
                        title: "âœ… STEP 5: ì‹ ì²­ ì™„ë£Œ",
                        content: `ëª¨ë“  ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!
ì‹ ì²­ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`,
                        action: "complete"
                    }
                ];
            } else if (serviceId === 'youth-package') {
                guidanceSteps = [
                    {
                        title: "ğŸ“ STEP 1: ìê²© í™•ì¸",
                        content: `ì²­ë…„ë„ì•½ê³„ì¢Œ ìê²©ì„ í™•ì¸í•´ë“œë¦´ê²Œìš”.
ë‚˜ì´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ë§Œ 19~34ì„¸)`,
                        action: "eligibility"
                    },
                    {
                        title: "ğŸ“‹ STEP 2: ì†Œë“ í™•ì¸",
                        content: `ì†Œë“ ê¸°ì¤€ì„ í™•ì¸í•©ë‹ˆë‹¤.
ì›” ì†Œë“ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.`,
                        action: "income"
                    },
                    {
                        title: "ğŸ¦ STEP 3: ê³„ì¢Œ ê°œì„¤",
                        content: `ì·¨ê¸‰ ì€í–‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”.
(ë†í˜‘, ì‹ í•œ, ìš°ë¦¬, í•˜ë‚˜, ê¸°ì—…, êµ­ë¯¼, ë¶€ì‚°, ê´‘ì£¼, ì „ë¶, ê²½ë‚¨, ìˆ˜í˜‘)`,
                        action: "bank"
                    },
                    {
                        title: "âœ… STEP 4: ì‹ ì²­ ì™„ë£Œ",
                        content: `ì²­ë…„ë„ì•½ê³„ì¢Œ ì‹ ì²­ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!`,
                        action: "complete"
                    }
                ];
            } else if (serviceId === 'emergency-support') {
                guidanceSteps = [
                    {
                        title: "ğŸš¨ STEP 1: ê¸´ê¸‰ ìƒí™© í™•ì¸",
                        content: `ì–´ë–¤ ê¸´ê¸‰ ìƒí™©ì´ì‹ ê°€ìš”?
1. ìƒê³„ ê³¤ë€
2. ì˜ë£Œë¹„ ë¶€ë‹´
3. ì£¼ê±° ìœ„ê¸°
4. ì¬ë‚œ í”¼í•´`,
                        action: "emergency-type"
                    },
                    {
                        title: "ğŸ“ STEP 2: ì—°ë½ì²˜ í™•ì¸",
                        content: `ê¸´ê¸‰ ì—°ë½ì„ ìœ„í•´ ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.`,
                        action: "contact"
                    },
                    {
                        title: "ğŸ“‹ STEP 3: ì‹ ì²­ì„œ ì‘ì„±",
                        content: `ê¸´ê¸‰ë³µì§€ ì‹ ì²­ì„œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.`,
                        action: "form"
                    },
                    {
                        title: "âœ… STEP 4: ì‹ ì²­ ì™„ë£Œ",
                        content: `ê¸´ê¸‰ë³µì§€ ì‹ ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.
ë‹´ë‹¹ìê°€ ê³§ ì—°ë½ë“œë¦´ ì˜ˆì •ì…ë‹ˆë‹¤.`,
                        action: "complete"
                    }
                ];
            } else if (serviceId === 'other' || serviceId === 'ê¸°íƒ€') {
                // ê¸°íƒ€ ì„œë¹„ìŠ¤ - ì‚¬ìš©ì ì…ë ¥
                guidanceSteps = [
                    {
                        title: "ğŸ“ STEP 1: ì„œë¹„ìŠ¤ ì…ë ¥",
                        content: `ì–´ë–¤ ì„œë¹„ìŠ¤ë¥¼ ì‹ ì²­í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?
ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.`,
                        action: "custom-input"
                    },
                    {
                        title: "ğŸ“‹ STEP 2: ì •ë³´ ì…ë ¥",
                        content: `í•„ìš”í•œ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.`,
                        action: "custom-form"
                    },
                    {
                        title: "ğŸ“ STEP 3: ì‹ ì²­ ë°©ë²• í™•ì¸",
                        content: `ì‹ ì²­ ë°©ë²•ì„ ì•ˆë‚´í•´ë“œë¦´ê²Œìš”.`,
                        action: "custom-guide"
                    },
                    {
                        title: "âœ… STEP 4: ì‹ ì²­ ì™„ë£Œ",
                        content: `ì‹ ì²­ ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`,
                        action: "complete"
                    }
                ];
            } else {
                // ê¸°ë³¸ ê°€ì´ë“œ
                guidanceSteps = [
                    {
                        title: "ğŸ“‹ STEP 1: ì„œë¹„ìŠ¤ ì •ë³´ í™•ì¸",
                        content: `${serviceId} ì„œë¹„ìŠ¤ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.`,
                        action: "info"
                    },
                    {
                        title: "ğŸ“ STEP 2: ì‹ ì²­ì„œ ì¤€ë¹„",
                        content: `í•„ìš”í•œ ì„œë¥˜ë¥¼ ì¤€ë¹„í•´ì£¼ì„¸ìš”.`,
                        action: "checklist"
                    },
                    {
                        title: "âœ… STEP 3: ì‹ ì²­ ì™„ë£Œ",
                        content: `ì‹ ì²­ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!`,
                        action: "complete"
                    }
                ];
            }
            
            // ê°€ì´ë“œ ì •ë³´ ì €ì¥
            currentGuidance.steps = guidanceSteps;
            currentGuidance.currentIndex = 0;
            currentGuidance.serviceId = serviceId;
            
            // ì²« ë²ˆì§¸ ë‹¨ê³„ ì‹œì‘
            showGuidanceStep(0);
        }
        
        // ì•ˆë‚´ ë‹¨ê³„ í‘œì‹œ
        function showGuidanceStep(index) {
            if (index < currentGuidance.steps.length) {
                const step = currentGuidance.steps[index];
                currentGuidance.currentIndex = index;
                
                // ì§„í–‰ ìƒí™© í‘œì‹œ
                const progress = `(${index + 1}/${currentGuidance.steps.length})`;
                let message = `<div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                                <strong style="font-size: 1.2em;">${step.title} ${progress}</strong>
                              </div>
                              <div style="padding: 10px;">${step.content}</div>`;
                
                // ì•¡ì…˜ ë²„íŠ¼ ì¶”ê°€
                if (step.action === 'checklist') {
                    message += '<div style="margin-top: 15px;">';
                    message += '<label style="display: block; margin: 8px 0;">';
                    message += '<input type="checkbox" id="doc1"> ì‹ ë¶„ì¦';
                    message += '</label>';
                    message += '<label style="display: block; margin: 8px 0;">';
                    message += '<input type="checkbox" id="doc2"> í†µì¥ì‚¬ë³¸';
                    message += '</label>';
                    message += '<label style="display: block; margin: 8px 0;">';
                    message += '<input type="checkbox" id="doc3"> ì†Œë“Â·ì¬ì‚° ì‹ ê³ ì„œ';
                    message += '</label>';
                    message += '<label style="display: block; margin: 8px 0;">';
                    message += '<input type="checkbox" id="doc4"> ì „ì›”ì„¸ ê³„ì•½ì„œ (í•´ë‹¹ì)';
                    message += '</label>';
                    message += '<button onclick="proceedToNextStep()" ';
                    message += 'style="margin-top: 10px; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">';
                    message += 'âœ… ëª¨ë‘ ì¤€ë¹„í–ˆì–´ìš” â†’ ë‹¤ìŒ ë‹¨ê³„';
                    message += '</button>';
                    message += '</div>';
                } else if (step.action === 'location') {
                    message += '<div style="margin-top: 15px;">';
                    message += '<input type="text" id="locationInput" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬" ';
                    message += 'style="padding: 10px; width: 60%; margin-right: 10px; border: 1px solid #ddd; border-radius: 5px;">';
                    message += '<button onclick="findLocationAndProceed()" ';
                    message += 'style="padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">';
                    message += 'ğŸ” ì£¼ë¯¼ì„¼í„° ì°¾ê¸°';
                    message += '</button>';
                    message += '</div>';
                } else if (step.action === 'form') {
                    message += '<div style="margin-top: 15px; background: #f8f9fa; padding: 15px; border-radius: 8px;">';
                    message += '<div style="margin-bottom: 10px;">';
                    message += '<label style="display: block; margin-bottom: 5px;">ì´ë¦„:</label>';
                    message += '<input type="text" id="formName" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">';
                    message += '</div>';
                    message += '<div style="margin-bottom: 10px;">';
                    message += '<label style="display: block; margin-bottom: 5px;">ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸:</label>';
                    message += '<input type="text" id="formSSN" placeholder="ì˜ˆ: 123456-1234567" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">';
                    message += '</div>';
                    message += '<div style="margin-bottom: 10px;">';
                    message += '<label style="display: block; margin-bottom: 5px;">ì£¼ì†Œ:</label>';
                    message += '<input type="text" id="formAddress" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">';
                    message += '</div>';
                    message += '<button onclick="submitFormAndProceed()" ';
                    message += 'style="margin-top: 10px; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">';
                    message += 'ğŸ“ ì‘ì„± ì™„ë£Œ â†’ ë‹¤ìŒ ë‹¨ê³„';
                    message += '</button>';
                    message += '</div>';
                } else if (step.action === 'booking') {
                    message += '<div style="margin-top: 15px;">';
                    message += '<label style="display: block; margin-bottom: 5px;">ë°©ë¬¸ ë‚ ì§œ:</label>';
                    message += '<input type="date" id="bookingDate" style="padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">';
                    message += '<label style="display: block; margin-bottom: 5px;">ë°©ë¬¸ ì‹œê°„:</label>';
                    message += '<select id="bookingTime" style="padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">';
                    message += '<option value="">ì‹œê°„ ì„ íƒ</option>';
                    message += '<option value="09:00">ì˜¤ì „ 9:00</option>';
                    message += '<option value="10:00">ì˜¤ì „ 10:00</option>';
                    message += '<option value="11:00">ì˜¤ì „ 11:00</option>';
                    message += '<option value="14:00">ì˜¤í›„ 2:00</option>';
                    message += '<option value="15:00">ì˜¤í›„ 3:00</option>';
                    message += '<option value="16:00">ì˜¤í›„ 4:00</option>';
                    message += '</select>';
                    message += '<button onclick="bookAndProceed()" ';
                    message += 'style="display: block; margin-top: 10px; padding: 10px 20px; background: #FF9800; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">';
                    message += 'ğŸ“… ì˜ˆì•½í•˜ê¸° â†’ ë‹¤ìŒ ë‹¨ê³„';
                    message += '</button>';
                    message += '</div>';
                } else if (step.action === 'custom-input') {
                    message += '<div style="margin-top: 15px;">';
                    message += '<textarea id="customServiceInput" placeholder="ì˜ˆ: ì—¬ê¶Œ ì¬ë°œê¸‰, í˜¼ì¸ì‹ ê³ , ì‚¬ì—…ìë“±ë¡ ë“±" ';
                    message += 'style="width: 100%; padding: 10px; height: 80px; border: 1px solid #ddd; border-radius: 5px; resize: vertical;"></textarea>';
                    message += '<button onclick="saveCustomServiceAndProceed()" ';
                    message += 'style="margin-top: 10px; padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">';
                    message += 'ğŸ’¾ ì €ì¥í•˜ê³  ë‹¤ìŒ ë‹¨ê³„ë¡œ â†’';
                    message += '</button>';
                    message += '</div>';
                } else if (step.action === 'custom-form') {
                    message += '<div style="margin-top: 15px; background: #f8f9fa; padding: 15px; border-radius: 8px;">';
                    message += '<div style="margin-bottom: 10px;">';
                    message += '<label style="display: block; margin-bottom: 5px;">ì¶”ê°€ ì •ë³´ë‚˜ ì§ˆë¬¸ì‚¬í•­:</label>';
                    message += '<textarea id="customInfoInput" placeholder="í•„ìš”í•œ ì •ë³´ë‚˜ ê¶ê¸ˆí•œ ì ì„ ììœ ë¡­ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”" ';
                    message += 'style="width: 100%; padding: 8px; height: 100px; border: 1px solid #ddd; border-radius: 4px;"></textarea>';
                    message += '</div>';
                    message += '<div style="margin-bottom: 10px;">';
                    message += '<label style="display: block; margin-bottom: 5px;">ì—°ë½ì²˜ (ì„ íƒ):</label>';
                    message += '<input type="tel" id="customContact" placeholder="010-0000-0000" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">';
                    message += '</div>';
                    message += '<button onclick="submitCustomInfoAndProceed()" ';
                    message += 'style="margin-top: 10px; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">';
                    message += 'ğŸ“ ì •ë³´ ì œì¶œ â†’ ë‹¤ìŒ ë‹¨ê³„';
                    message += '</button>';
                    message += '</div>';
                } else if (step.action === 'custom-guide') {
                    const customService = localStorage.getItem('customService') || 'ì…ë ¥í•˜ì‹  ì„œë¹„ìŠ¤';
                    message += '<div style="margin-top: 15px; background: #e3f2fd; padding: 15px; border-radius: 8px;">';
                    message += '<h4>ğŸ“Œ ' + customService + ' ì‹ ì²­ ë°©ë²•</h4>';
                    message += '<p style="margin-top: 10px;">ì…ë ¥í•˜ì‹  ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì•ˆë‚´í•´ë“œë¦½ë‹ˆë‹¤:</p>';
                    message += '<ol style="margin-top: 10px; padding-left: 20px;">';
                    message += '<li>ê°€ê¹Œìš´ ì£¼ë¯¼ì„¼í„° ë˜ëŠ” êµ¬ì²­ ë°©ë¬¸</li>';
                    message += '<li>ì •ë¶€24(www.gov.kr)ì—ì„œ ì˜¨ë¼ì¸ ì‹ ì²­ í™•ì¸</li>';
                    message += '<li>í•„ìš” ì„œë¥˜: ì‹ ë¶„ì¦, ê´€ë ¨ ì¦ë¹™ì„œë¥˜</li>';
                    message += '<li>ì½œì„¼í„° ë¬¸ì˜: 110 (ì •ë¶€ë¯¼ì›ì•ˆë‚´)</li>';
                    message += '</ol>';
                    message += '<button onclick="proceedToNextStep()" ';
                    message += 'style="margin-top: 15px; padding: 10px 20px; background: #FF9800; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">';
                    message += 'í™•ì¸í–ˆì–´ìš” â†’ ë‹¤ìŒ ë‹¨ê³„';
                    message += '</button>';
                    message += '</div>';
                } else if (step.action === 'complete') {
                    message += '<div style="margin-top: 15px; background: #d4edda; padding: 20px; border-radius: 10px; text-align: center;">';
                    message += '<div style="font-size: 3em; margin-bottom: 10px;">ğŸ‰</div>';
                    message += '<div style="font-size: 1.2em; font-weight: bold; color: #155724;">ì‹ ì²­ ì¤€ë¹„ê°€ ëª¨ë‘ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
                    message += '<button onclick="showSummary()" ';
                    message += 'style="margin-top: 15px; padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">';
                    message += 'ğŸ“‹ ì‹ ì²­ ë‚´ìš© í™•ì¸í•˜ê¸°';
                    message += '</button>';
                    message += '<button onclick="startNewApplication()" ';
                    message += 'style="margin-top: 10px; margin-left: 10px; padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">';
                    message += 'ğŸ”„ ìƒˆë¡œìš´ ì‹ ì²­ ì‹œì‘';
                    message += '</button>';
                    message += '</div>';
                } else {
                    // ê¸°ë³¸ ë‹¤ìŒ ë²„íŠ¼
                    message += '<div style="margin-top: 15px;">';
                    message += '<button onclick="proceedToNextStep()" ';
                    message += 'style="padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">';
                    message += 'ë‹¤ìŒ ë‹¨ê³„ë¡œ â†’';
                    message += '</button>';
                    message += '</div>';
                }
                
                // ì´ì „ ë‹¨ê³„ ë²„íŠ¼ (ì²« ë‹¨ê³„ê°€ ì•„ë‹Œ ê²½ìš°)
                if (index > 0) {
                    message += '<button onclick="goToPreviousStep()" ';
                    message += 'style="margin-top: 10px; padding: 8px 16px; background: #e0e0e0; color: #666; border: none; border-radius: 5px; cursor: pointer;">';
                    message += 'â† ì´ì „ ë‹¨ê³„';
                    message += '</button>';
                }
                
                addChatMessage(message, 'bot');
            }
        }

        // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰
        function proceedToNextStep() {
            const nextIndex = currentGuidance.currentIndex + 1;
            if (nextIndex < currentGuidance.steps.length) {
                showGuidanceStep(nextIndex);
            }
        }

        // ì´ì „ ë‹¨ê³„ë¡œ ëŒì•„ê°€ê¸°
        function goToPreviousStep() {
            const prevIndex = currentGuidance.currentIndex - 1;
            if (prevIndex >= 0) {
                showGuidanceStep(prevIndex);
            }
        }

        // ìœ„ì¹˜ ì°¾ê¸° í›„ ë‹¤ìŒ ë‹¨ê³„
        function findLocationAndProceed() {
            const location = document.getElementById('locationInput').value;
            if (location) {
                addChatMessage(`ğŸ“ "${location}" ì£¼ë³€ì˜ ì£¼ë¯¼ì„¼í„°ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!<br>
                              ğŸ“Œ ê°•ë‚¨êµ¬ì²­: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í•™ë™ë¡œ 426<br>
                              â˜ï¸ ì „í™”: 02-3423-5555<br>
                              ğŸ• ìš´ì˜ì‹œê°„: í‰ì¼ 09:00-18:00`, 'bot');
                setTimeout(() => proceedToNextStep(), 2000);
            } else {
                alert('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        // í¼ ì œì¶œ í›„ ë‹¤ìŒ ë‹¨ê³„
        function submitFormAndProceed() {
            const name = document.getElementById('formName').value;
            const ssn = document.getElementById('formSSN').value;
            const address = document.getElementById('formAddress').value;
            
            if (name && ssn && address) {
                addChatMessage(`âœ… ì‹ ì²­ì„œ ì‘ì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!<br>
                              ì´ë¦„: ${name}<br>
                              ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸: ${ssn.substring(0, 6)}-*******<br>
                              ì£¼ì†Œ: ${address}`, 'bot');
                setTimeout(() => proceedToNextStep(), 2000);
            } else {
                alert('ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        // ì˜ˆì•½ í›„ ë‹¤ìŒ ë‹¨ê³„
        function bookAndProceed() {
            const date = document.getElementById('bookingDate').value;
            const time = document.getElementById('bookingTime').value;
            
            if (date && time) {
                addChatMessage(`ğŸ“… ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!<br>
                              ë‚ ì§œ: ${date}<br>
                              ì‹œê°„: ${time}<br>
                              âš ï¸ ë°©ë¬¸ ì‹œ ì‹ ë¶„ì¦ê³¼ ì¤€ë¹„í•œ ì„œë¥˜ë¥¼ ê¼­ ì§€ì°¸í•´ì£¼ì„¸ìš”.`, 'bot');
                setTimeout(() => proceedToNextStep(), 2000);
            } else {
                alert('ë‚ ì§œì™€ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            }
        }

        // ì‹ ì²­ ìš”ì•½ ë³´ê¸°
        function showSummary() {
            addChatMessage(`ğŸ“‹ <strong>ì‹ ì²­ ìš”ì•½</strong><br>
                          ì„œë¹„ìŠ¤: ${currentGuidance.serviceId}<br>
                          ì§„í–‰ ë‹¨ê³„: ëª¨ë“  ë‹¨ê³„ ì™„ë£Œ<br>
                          ì¤€ë¹„ ì„œë¥˜: âœ… ì™„ë£Œ<br>
                          ì‹ ì²­ì„œ: âœ… ì‘ì„± ì™„ë£Œ<br>
                          ë°©ë¬¸ ì˜ˆì•½: âœ… ì™„ë£Œ<br><br>
                          ğŸ’¡ ì£¼ë¯¼ì„¼í„° ë°©ë¬¸ ì‹œ ì´ ë‚´ìš©ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”!`, 'bot');
        }

        // ìƒˆë¡œìš´ ì‹ ì²­ ì‹œì‘
        function startNewApplication() {
            currentGuidance = {
                steps: [],
                currentIndex: 0,
                serviceId: null
            };
            addChatMessage('ìƒˆë¡œìš´ ì‹ ì²­ì„ ì‹œì‘í•˜ë ¤ë©´ ì›í•˜ì‹œëŠ” ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'bot');
        }

        // ë‚˜ì´ ì§ì ‘ ì…ë ¥ í‘œì‹œ
        function showCustomAgeInput() {
            document.getElementById('customAgeInput').style.display = 'block';
            // ë‹¤ë¥¸ ë²„íŠ¼ ì„ íƒ í•´ì œ
            document.querySelectorAll('[data-age]').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector('[data-age="other"]').classList.add('selected');
        }

        // ë‚˜ì´ ì§ì ‘ ì…ë ¥ ì œì¶œ
        function submitCustomAge() {
            const customAge = document.getElementById('customAge').value;
            if (customAge) {
                userProfile.age = 'custom';
                userProfile.customAge = customAge;
                document.getElementById('nextBtn').disabled = false;
                alert(`${customAge}ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                // ìƒí™© ì˜µì…˜ ì¤€ë¹„
                prepareSituationOptions('custom');
            } else {
                alert('ë‚˜ì´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        // ìƒí™© ì§ì ‘ ì…ë ¥ í‘œì‹œ
        function showCustomSituationInput() {
            document.getElementById('customSituationInput').style.display = 'block';
            // ë‹¤ë¥¸ ë²„íŠ¼ ì„ íƒ í•´ì œ
            document.querySelectorAll('[data-situation]').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector('[data-situation="other"]').classList.add('selected');
        }

        // ìƒí™© ì§ì ‘ ì…ë ¥ ì œì¶œ
        function submitCustomSituation() {
            const customSituation = document.getElementById('customSituation').value;
            if (customSituation) {
                userProfile.situation = 'custom';
                userProfile.customSituation = customSituation;
                document.getElementById('nextBtn').disabled = false;
                alert(`"${customSituation}" ìƒí™©ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                // ì„¸ë¶€ ì¡°ê±´ ì¤€ë¹„
                prepareDetailConditions('custom');
            } else {
                alert('ìƒí™©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        // ì‚¬ìš©ì ì •ì˜ ì„œë¹„ìŠ¤ ì €ì¥ í›„ ì§„í–‰
        function saveCustomServiceAndProceed() {
            const customService = document.getElementById('customServiceInput').value;
            if (customService) {
                localStorage.setItem('customService', customService);
                addChatMessage(`âœ… "${customService}" ì„œë¹„ìŠ¤ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.`, 'bot');
                setTimeout(() => proceedToNextStep(), 1500);
            } else {
                alert('ì„œë¹„ìŠ¤ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        // ì„¸ë¶€ ì¡°ê±´ ì§ì ‘ ì…ë ¥ í‘œì‹œ
        function showCustomConditionInput() {
            const checkbox = event.target;
            const inputDiv = document.getElementById('customConditionInput');
            if (checkbox.checked) {
                inputDiv.style.display = 'block';
            } else {
                inputDiv.style.display = 'none';
            }
        }

        // ì„¸ë¶€ ì¡°ê±´ ì§ì ‘ ì…ë ¥ ì œì¶œ
        function submitCustomCondition() {
            const customCondition = document.getElementById('customCondition').value;
            if (customCondition) {
                userProfile.conditions.customCondition = customCondition;
                alert(`ì¶”ê°€ ì¡°ê±´ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤: ${customCondition}`);
                document.getElementById('nextBtn').disabled = false;
            } else {
                alert('ì¡°ê±´ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }

        // ì‚¬ìš©ì ì •ì˜ ì •ë³´ ì œì¶œ í›„ ì§„í–‰
        function submitCustomInfoAndProceed() {
            const info = document.getElementById('customInfoInput').value;
            const contact = document.getElementById('customContact').value;
            
            if (info) {
                let confirmMessage = `âœ… ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!<br>`;
                confirmMessage += `ë‚´ìš©: ${info}<br>`;
                if (contact) {
                    confirmMessage += `ì—°ë½ì²˜: ${contact}`;
                }
                addChatMessage(confirmMessage, 'bot');
                setTimeout(() => proceedToNextStep(), 1500);
            } else {
                alert('ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        }
        
        // ë ˆì´ë¸” í—¬í¼ í•¨ìˆ˜ë“¤
        function getAgeLabel(age) {
            const labels = {
                'youth': 'ë¯¸ì„±ë…„ì',
                'young': 'ì²­ë…„',
                'middle': 'ì¤‘ì¥ë…„',
                'early-senior': 'ì˜ˆë¹„ë…¸ì¸',
                'senior': 'ë…¸ì¸',
                'senior-plus': 'ê³ ë ¹ë…¸ì¸'
            };
            return labels[age] || age;
        }
        
        function getSituationLabel(situation) {
            const labels = {
                'pension': 'ì—°ê¸ˆ/ìˆ˜ë‹¹',
                'job': 'ì·¨ì—…/ì°½ì—…',
                'medical': 'ì˜ë£Œ/ê±´ê°•',
                'housing': 'ì£¼ê±°ë¬¸ì œ',
                'emergency': 'ê¸´ê¸‰ì§€ì›'
            };
            return labels[situation] || situation;
        }
        
        function getConditionLabel(key, value) {
            const labels = {
                'income-low': 'ì†Œë“í•˜ìœ„ 70%',
                'income-very-low': 'ê¸°ì´ˆìƒí™œìˆ˜ê¸‰',
                'alone': 'ë…ê±°',
                'disabled': 'ì¥ì• ',
                'jobStatus-unemployed': 'êµ¬ì§ì¤‘'
            };
            return labels[`${key}-${value}`] || value;
        }
        
        // ì¶”ì²œ ì„œë¹„ìŠ¤ ìƒì„± (ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€)
        function getRecommendations(age, situation) {
            let html = '<div style="font-weight: bold; margin-bottom: 10px;">ğŸ¯ ë§ì¶¤ ì¶”ì²œ ì„œë¹„ìŠ¤</div>';
            
            // ë‚˜ì´ì™€ ìƒí™©ì— ë”°ë¥¸ ì¶”ì²œ
            if (age === 'senior' && situation === 'financial') {
                html += `
                    <div style="margin-bottom: 8px;">
                        <button onclick="askChatbot('ê¸°ì´ˆì—°ê¸ˆ ì‹ ì²­ë°©ë²•')" style="width: 100%; padding: 10px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            âœ… ê¸°ì´ˆì—°ê¸ˆ (ì›” 33ë§Œì›)
                        </button>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <button onclick="askChatbot('ë…¸ì¸ì¼ìë¦¬ ì‹ ì²­')" style="width: 100%; padding: 10px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ’¼ ë…¸ì¸ì¼ìë¦¬ (ì›” 27-71ë§Œì›)
                        </button>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <button onclick="askChatbot('ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì ì‹ ì²­')" style="width: 100%; padding: 10px; background: #FF9800; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ  ê¸°ì´ˆìƒí™œìˆ˜ê¸‰
                        </button>
                    </div>`;
            } else if (age === 'adult' && situation === 'job') {
                html += `
                    <div style="margin-bottom: 8px;">
                        <button onclick="askChatbot('êµ­ë¯¼ì·¨ì—…ì§€ì›ì œë„')" style="width: 100%; padding: 10px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ“‹ êµ­ë¯¼ì·¨ì—…ì§€ì›ì œë„
                        </button>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <button onclick="askChatbot('ì‹¤ì—…ê¸‰ì—¬ ì‹ ì²­')" style="width: 100%; padding: 10px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ’° ì‹¤ì—…ê¸‰ì—¬
                        </button>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <button onclick="askChatbot('ì§ì—…í›ˆë ¨ ì§€ì›')" style="width: 100%; padding: 10px; background: #9C27B0; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ“ ì§ì—…í›ˆë ¨
                        </button>
                    </div>`;
            } else if (situation === 'emergency') {
                html += `
                    <div style="margin-bottom: 8px;">
                        <button onclick="askChatbot('ê¸´ê¸‰ë³µì§€ì§€ì› ì‹ ì²­')" style="width: 100%; padding: 10px; background: #F44336; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸš¨ ê¸´ê¸‰ë³µì§€ì§€ì›
                        </button>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <button onclick="askChatbot('ê¸´ê¸‰ìƒê³„ë¹„ ì§€ì›')" style="width: 100%; padding: 10px; background: #E91E63; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ’µ ê¸´ê¸‰ìƒê³„ë¹„
                        </button>
                    </div>`;
            } else if (situation === 'health') {
                html += `
                    <div style="margin-bottom: 8px;">
                        <button onclick="askChatbot('ì˜ë£Œê¸‰ì—¬ ì‹ ì²­')" style="width: 100%; padding: 10px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ¥ ì˜ë£Œê¸‰ì—¬
                        </button>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <button onclick="askChatbot('ì¬ë‚œì ì˜ë£Œë¹„ ì§€ì›')" style="width: 100%; padding: 10px; background: #FF5722; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ’Š ì¬ë‚œì ì˜ë£Œë¹„
                        </button>
                    </div>`;
            } else if (situation === 'housing') {
                html += `
                    <div style="margin-bottom: 8px;">
                        <button onclick="askChatbot('ì£¼ê±°ê¸‰ì—¬ ì‹ ì²­')" style="width: 100%; padding: 10px; background: #795548; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ  ì£¼ê±°ê¸‰ì—¬
                        </button>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <button onclick="askChatbot('ê³µê³µì„ëŒ€ì£¼íƒ ì‹ ì²­')" style="width: 100%; padding: 10px; background: #607D8B; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ¢ ê³µê³µì„ëŒ€ì£¼íƒ
                        </button>
                    </div>`;
            } else if (age === 'youth' && situation === 'family') {
                html += `
                    <div style="margin-bottom: 8px;">
                        <button onclick="askChatbot('ì•„ë™ìˆ˜ë‹¹ ì‹ ì²­')" style="width: 100%; padding: 10px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ‘¶ ì•„ë™ìˆ˜ë‹¹
                        </button>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <button onclick="askChatbot('êµìœ¡ê¸‰ì—¬ ì‹ ì²­')" style="width: 100%; padding: 10px; background: #3F51B5; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ“š êµìœ¡ê¸‰ì—¬
                        </button>
                    </div>`;
            } else {
                // ê¸°ë³¸ ì¶”ì²œ
                html += `
                    <div style="margin-bottom: 8px;">
                        <button onclick="askChatbot('ë³µì§€ ì„œë¹„ìŠ¤ ì•ˆë‚´')" style="width: 100%; padding: 10px; background: #9E9E9E; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ“‹ ì¢…í•© ë³µì§€ ì•ˆë‚´
                        </button>
                    </div>`;
            }
            
            html += `
                <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 5px; font-size: 0.85em;">
                    ğŸ’¡ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ìì„¸í•œ ì•ˆë‚´ë¥¼ ë°›ì„ ìˆ˜ ìˆì–´ìš”!
                </div>`;
            
            return html;
        }
        
        // ì±—ë´‡ì— ì§ˆë¬¸ ì „ë‹¬
        function askChatbot(question) {
            document.getElementById('chatInput').value = question;
            sendTextMessage();
        }
        
        // ì‹œìŠ¤í…œ ì´ˆê¸°í™” í•¨ìˆ˜
        function initializeSystem() {
            // ì €ì¥ëœ ì„¤ì • ë¡œë“œ
            const savedProvider = localStorage.getItem('apiProvider');
            const savedApiKey = localStorage.getItem('apiKey');
            const savedEndpoint = localStorage.getItem('localSLMEndpoint');
            const savedHybrid = localStorage.getItem('useHybrid');
            const savedRAG = localStorage.getItem('ragEnabled');
            
            if (savedProvider) apiConfig.provider = savedProvider;
            if (savedApiKey) apiConfig.apiKey = savedApiKey;
            if (savedEndpoint) apiConfig.localSLMEndpoint = savedEndpoint;
            if (savedHybrid !== null) apiConfig.useHybrid = savedHybrid !== 'false';
            if (savedRAG !== null) ragConfig.enabled = savedRAG !== 'false';
            
            // API í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            apiConfig.useAPI = (apiConfig.provider && 
                (apiConfig.provider === 'local' || apiConfig.apiKey));
            
            // í—¤ë” ìƒíƒœ ì—…ë°ì´íŠ¸
            updateSystemStatus();
            
            // ì‹œìŠ¤í…œ ìƒíƒœ ë¡œê·¸
            console.log('ğŸš€ í•˜ì´ë¸Œë¦¬ë“œ ë¯¼ì›ì²˜ë¦¬ AI í‚¤ì˜¤ìŠ¤í¬ v3.0');
            console.log('âœ… í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ:', apiConfig.useHybrid ? 'í™œì„±' : 'ë¹„í™œì„±');
            console.log('âœ… RAG ì‹œìŠ¤í…œ:', ragConfig.enabled ? 'í™œì„±' : 'ë¹„í™œì„±');
            console.log('âœ… ë¯¼ê°ì •ë³´ íƒì§€: í™œì„±');
            console.log('âœ… API ì œê³µì:', apiConfig.provider || 'ì—†ìŒ');
            
            // ë³´ì•ˆ ê°ì‚¬ ë¡œê·¸ ì´ˆê¸°í™”
            const logs = JSON.parse(localStorage.getItem('sensitiveInfoLogs') || '[]');
            console.log('ğŸ“Š ê¸°ì¡´ ë³´ì•ˆ ê°ì‚¬ ë¡œê·¸:', logs.length, 'ê±´');
        }
        
        // ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSystemStatus() {
            const statusText = document.getElementById('statusText');
            if (statusText) {
                if (apiConfig.useAPI) {
                    if (apiConfig.provider === 'local') {
                        statusText.textContent = 'ë¡œì»¬ SLM ëª¨ë“œ';
                    } else {
                        statusText.textContent = `${apiConfig.provider === 'openai' ? 'OpenAI' : 'Google Gemini'} ëª¨ë“œ`;
                    }
                } else {
                    statusText.textContent = 'ë¡œì»¬ AI ëª¨ë“œ';
                }
                
                // í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ í‘œì‹œ
                if (apiConfig.useHybrid) {
                    statusText.textContent += ' (í•˜ì´ë¸Œë¦¬ë“œ)';
                }
            }
        }
        
        // ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            initSpeechRecognition();
            
            // ì‹œìŠ¤í…œ ì´ˆê¸°í™”
            initializeSystem();
            
            // ìŒì„± ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
            const speechEnabled = localStorage.getItem('speechEnabled');
            if (speechEnabled === 'false') {
                isSpeechEnabled = false;
                document.getElementById('speechIcon').textContent = 'ğŸ”‡';
                document.getElementById('speechText').textContent = 'ìŒì„± OFF';
            }
            
            // API ì„¤ì • í™•ì¸
            if (apiConfig.provider && apiConfig.apiKey) {
                apiConfig.useAPI = true;
                const statusText = document.getElementById('statusText');
                statusText.textContent = `${apiConfig.provider === 'openai' ? 'OpenAI' : 'Google AI'} ëª¨ë“œ`;
            }
            
            // ì‹œê°„ ì„¤ì •
            const timeElements = document.querySelectorAll('.message-time');
            const currentTime = new Date().toLocaleTimeString('ko-KR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            timeElements.forEach(el => {
                if (el.textContent === '') {
                    el.textContent = currentTime;
                }
            });
            
            // ìŒì„± ì—”ì§„ ì´ˆê¸°í™” (í•œêµ­ì–´ ìŒì„± ë¡œë“œ)
            if ('speechSynthesis' in window) {
                window.speechSynthesis.getVoices();
                // ìŒì„± ë¡œë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                window.speechSynthesis.onvoiceschanged = function() {
                    window.speechSynthesis.getVoices();
                };
            }
        });
    </script>
</body>
</html>